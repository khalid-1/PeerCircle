(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();const f={mentorsData:[{name:"Meerah Ahmed Alansi",year:"BSN Year 4",email:"meera.22904065@rakmhsu.ac.ae",quote:"Happy to support with clinical placement anxiety and confidence on the ward.",tags:["Clinical Support","Placement Anxiety"]},{name:"Seham Mohammed Abuhatab",year:"BSN Year 4",email:"seham.22904030@rakmhsu.ac.ae",quote:"Let’s talk about balancing life, studies, and clinicals without burning out.",tags:["Stress & Burnout","Time Management"]},{name:"Doaa Mohamed Sharafeldin",year:"BSN Year 4",email:"doaa.22904079@rakmhsu.ac.ae",quote:"Here for exam anxiety, study plans, and last-minute motivation.",tags:["Exam Prep","Study Skills"]},{name:"Khalid Said Islam",year:"BSN Year 4",email:"khalid.22904036@rakmhsu.ac.ae",quote:"Happy to chat about tech tools, note-taking, and keeping organized.",tags:["Study Skills","Time Management"]},{name:"Amina Sulieman Yassin",year:"BSN Year 4",email:"amina.22904026@rakmhsu.ac.ae",quote:"Let’s make pharmacology and pathophysiology feel less scary.",tags:["Pharmacology","Pathophysiology"]},{name:"Haya Hani Al Halabi",year:"BSN Year 3",email:"haya.23904004@rakmhsu.ac.ae",quote:"Supporting you with first clinicals, communication, and reflective practice.",tags:["Clinical Support","Communication"]},{name:"Khalifa Khalid Alshehhi",year:"BSN Year 3",email:"khalifa.23904112@rakmhsu.ac.ae",quote:"Happy to discuss exam strategies and OSCE preparation.",tags:["Exam Prep","OSCE"]},{name:"Abdalqader Abdou",year:"BSN Year 3",email:"abdalqader.23904036@rakmhsu.ac.ae",quote:"We can work together on clinical reasoning and case-based thinking.",tags:["Clinical Reasoning","Case Discussions"]},{name:"Bushra Garallah Ali",year:"BSN Year 2",email:"bushra.24904025@rakmhsu.ac.ae",quote:"Here for first-year nerves, basics, and building your confidence.",tags:["First Year Support","Foundations"]},{name:"Ghofran G A Abuzour",year:"BSN Year 2",email:"ghofran.24904022@rakmhsu.ac.ae",quote:"Happy to help with pharmacology flashcards and study routines.",tags:["Pharmacology","Study Routines"]},{name:"Leen Abdelhakim Toubeh",year:"BSN Year 2",email:"leen.24904034@rakmhsu.ac.ae",quote:"Let’s focus on building study habits that actually work for you.",tags:["Study Skills","Motivation"]},{name:"Raghad Mohammad",year:"BSN Year 2",email:"raghad.24904030@rakmhsu.ac.ae",quote:"Here for stress management, grounding techniques, and check-ins.",tags:["Stress Management","Coping Skills"]},{name:"Haneen Jamal Hjaila",year:"BSN Year 2",email:"haneen.24904019@rakmhsu.ac.ae",quote:"Let’s work on confidence, presentations, and speaking up in class.",tags:["Confidence","Presentations"]}],topicsData:[],sessionsData:[],peerMessages:[],mentorOverrides:{},currentUserRole:"student",currentUserData:null,isSignUpMode:!1};function jt(i){f.topicsData=i}function Yt(i){f.sessionsData=i}function Wt(i){f.peerMessages=i}function qt(i){f.mentorOverrides=i}function Ke(i){f.currentUserRole=i}function Qe(i){f.currentUserData=i}function Xt(i){return db.collection("topics").onSnapshot(e=>{const t=e.docs.map(a=>({...a.data(),id:a.id}));jt(t),i&&i(t)})}async function Gt(i){return await db.collection("topics").doc(i).delete()}async function Vt(i){return await db.collection("topic_suggestions").add({...i,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp()})}async function Ze(i){try{const e=await db.collection("mentor_profiles").get(),t={};e.forEach(n=>{t[n.id]=n.data()});const a=i.map(async n=>{try{if(t[n.email]&&t[n.email].photoURL)return;const r=await db.collection("users").where("email","==",n.email).limit(1).get();if(!r.empty){const s=r.docs[0].data();s.photoURL&&(t[n.email]||(t[n.email]={}),t[n.email].photoURL=s.photoURL)}}catch{}});return await Promise.all(a),qt(t),t}catch(e){return console.error("Error fetching mentor profiles:",e),{}}}async function vt(i,e){return await db.collection("mentor_profiles").doc(i).set({...e,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}function Ft(i){return db.collection("sessions").orderBy("date","asc").onSnapshot(e=>{const t=e.docs.map(a=>({id:a.id,...a.data()}));Yt(t),i&&i(t)})}async function Kt(i){return await db.collection("sessions").add({...i,createdAt:firebase.firestore.FieldValue.serverTimestamp()})}async function Qt(i,e){return await db.collection("sessions").doc(i).update({...e,updatedAt:firebase.firestore.FieldValue.serverTimestamp()})}async function Zt(i){return await db.collection("sessions").doc(i).delete()}function Jt(i){return db.collection("requests").orderBy("createdAt","desc").onSnapshot(e=>{const t=e.docs.map(a=>({id:a.id,...a.data()}));Wt(t),i&&i(t)})}async function ea(i){return await db.collection("requests").add({...i,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp()})}async function ta(i,e){return await db.collection("requests").doc(i).update({status:"accepted",acceptedBy:e||"anonymous",acceptedAt:firebase.firestore.FieldValue.serverTimestamp()})}async function Je(i){return await db.collection("users").doc(i).get()}async function aa(i,e){return await db.collection("users").doc(i).set({...e,createdAt:firebase.firestore.FieldValue.serverTimestamp()})}async function ia(i,e){return await db.collection("users").doc(i).update(e)}async function ra(i,e){return await(await storage.ref().child(`users/${i}/profile.jpg`).put(e)).ref.getDownloadURL()}async function na(i){return await db.collection("users").doc(i).update({photoURL:firebase.firestore.FieldValue.delete()})}function x(i){return i?i.replace(/[&<>"']/g,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return e}}):""}function ke(i){if(!i)return"U";const e=i.trim().split(" ");return e.length>=2?(e[0][0]+e[e.length-1][0]).toUpperCase():i.substring(0,2).toUpperCase()}function et(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);e&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,a)}return t}function bt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?et(Object(t),!0).forEach(function(a){da(i,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):et(Object(t)).forEach(function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(t,a))})}return i}function sa(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var a=t.call(i,e);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(i)}function yt(i){var e=sa(i,"string");return typeof e=="symbol"?e:e+""}function Te(i){"@babel/helpers - typeof";return Te=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Te(i)}function oa(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function tt(i,e){for(var t=0;t<e.length;t++){var a=e[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(i,yt(a.key),a)}}function la(i,e,t){return e&&tt(i.prototype,e),t&&tt(i,t),Object.defineProperty(i,"prototype",{writable:!1}),i}function da(i,e,t){return e=yt(e),e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function xt(i){return ca(i)||ua(i)||ha(i)||ma()}function ca(i){if(Array.isArray(i))return Se(i)}function ua(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function ha(i,e){if(i){if(typeof i=="string")return Se(i,e);var t=Object.prototype.toString.call(i).slice(8,-1);if(t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set")return Array.from(i);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Se(i,e)}}function Se(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,a=new Array(e);t<e;t++)a[t]=i[t];return a}function ma(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Me=typeof window<"u"&&typeof window.document<"u",_=Me?window:{},ze=Me&&_.document.documentElement?"ontouchstart"in _.document.documentElement:!1,_e=Me?"PointerEvent"in _:!1,E="cropper",je="all",wt="crop",Et="move",kt="zoom",ee="e",te="w",ne="s",q="n",ue="ne",he="nw",me="se",fe="sw",Be="".concat(E,"-crop"),at="".concat(E,"-disabled"),N="".concat(E,"-hidden"),it="".concat(E,"-hide"),fa="".concat(E,"-invisible"),Ee="".concat(E,"-modal"),Ae="".concat(E,"-move"),ge="".concat(E,"Action"),xe="".concat(E,"Preview"),Ye="crop",Mt="move",Dt="none",Ne="crop",Pe="cropend",Oe="cropmove",Re="cropstart",rt="dblclick",pa=ze?"touchstart":"mousedown",ga=ze?"touchmove":"mousemove",va=ze?"touchend touchcancel":"mouseup",nt=_e?"pointerdown":pa,st=_e?"pointermove":ga,ot=_e?"pointerup pointercancel":va,lt="ready",dt="resize",ct="wheel",$e="zoom",ut="image/jpeg",ba=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,ya=/^data:/,xa=/^data:image\/jpeg;base64,/,wa=/^img|canvas$/i,It=200,Lt=100,ht={viewMode:0,dragMode:Ye,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:It,minContainerHeight:Lt,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Ea='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',ka=Number.isNaN||_.isNaN;function p(i){return typeof i=="number"&&!ka(i)}var mt=function(e){return e>0&&e<1/0};function Le(i){return typeof i>"u"}function re(i){return Te(i)==="object"&&i!==null}var Ma=Object.prototype.hasOwnProperty;function se(i){if(!re(i))return!1;try{var e=i.constructor,t=e.prototype;return e&&t&&Ma.call(t,"isPrototypeOf")}catch{return!1}}function A(i){return typeof i=="function"}var Da=Array.prototype.slice;function Ct(i){return Array.from?Array.from(i):Da.call(i)}function I(i,e){return i&&A(e)&&(Array.isArray(i)||p(i.length)?Ct(i).forEach(function(t,a){e.call(i,t,a,i)}):re(i)&&Object.keys(i).forEach(function(t){e.call(i,i[t],t,i)})),i}var k=Object.assign||function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return re(e)&&a.length>0&&a.forEach(function(r){re(r)&&Object.keys(r).forEach(function(s){e[s]=r[s]})}),e},Ia=/\.\d*(?:0|9){12}\d*$/;function de(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e11;return Ia.test(i)?Math.round(i*e)/e:i}var La=/^width|height|left|top|marginLeft|marginTop$/;function G(i,e){var t=i.style;I(e,function(a,n){La.test(n)&&p(a)&&(a="".concat(a,"px")),t[n]=a})}function Ca(i,e){return i.classList?i.classList.contains(e):i.className.indexOf(e)>-1}function S(i,e){if(e){if(p(i.length)){I(i,function(a){S(a,e)});return}if(i.classList){i.classList.add(e);return}var t=i.className.trim();t?t.indexOf(e)<0&&(i.className="".concat(t," ").concat(e)):i.className=e}}function z(i,e){if(e){if(p(i.length)){I(i,function(t){z(t,e)});return}if(i.classList){i.classList.remove(e);return}i.className.indexOf(e)>=0&&(i.className=i.className.replace(e,""))}}function oe(i,e,t){if(e){if(p(i.length)){I(i,function(a){oe(a,e,t)});return}t?S(i,e):z(i,e)}}var Ta=/([a-z\d])([A-Z])/g;function We(i){return i.replace(Ta,"$1-$2").toLowerCase()}function Ue(i,e){return re(i[e])?i[e]:i.dataset?i.dataset[e]:i.getAttribute("data-".concat(We(e)))}function ve(i,e,t){re(t)?i[e]=t:i.dataset?i.dataset[e]=t:i.setAttribute("data-".concat(We(e)),t)}function Sa(i,e){if(re(i[e]))try{delete i[e]}catch{i[e]=void 0}else if(i.dataset)try{delete i.dataset[e]}catch{i.dataset[e]=void 0}else i.removeAttribute("data-".concat(We(e)))}var Tt=/\s\s*/,St=(function(){var i=!1;if(Me){var e=!1,t=function(){},a=Object.defineProperty({},"once",{get:function(){return i=!0,e},set:function(r){e=r}});_.addEventListener("test",t,a),_.removeEventListener("test",t,a)}return i})();function U(i,e,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=t;e.trim().split(Tt).forEach(function(r){if(!St){var s=i.listeners;s&&s[r]&&s[r][t]&&(n=s[r][t],delete s[r][t],Object.keys(s[r]).length===0&&delete s[r],Object.keys(s).length===0&&delete i.listeners)}i.removeEventListener(r,n,a)})}function $(i,e,t){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},n=t;e.trim().split(Tt).forEach(function(r){if(a.once&&!St){var s=i.listeners,o=s===void 0?{}:s;n=function(){delete o[r][t],i.removeEventListener(r,n,a);for(var u=arguments.length,l=new Array(u),d=0;d<u;d++)l[d]=arguments[d];t.apply(i,l)},o[r]||(o[r]={}),o[r][t]&&i.removeEventListener(r,o[r][t],a),o[r][t]=n,i.listeners=o}i.addEventListener(r,n,a)})}function ce(i,e,t){var a;return A(Event)&&A(CustomEvent)?a=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0}):(a=document.createEvent("CustomEvent"),a.initCustomEvent(e,!0,!0,t)),i.dispatchEvent(a)}function Bt(i){var e=i.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var Ce=_.location,Ba=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function ft(i){var e=i.match(Ba);return e!==null&&(e[1]!==Ce.protocol||e[2]!==Ce.hostname||e[3]!==Ce.port)}function pt(i){var e="timestamp=".concat(new Date().getTime());return i+(i.indexOf("?")===-1?"?":"&")+e}function pe(i){var e=i.rotate,t=i.scaleX,a=i.scaleY,n=i.translateX,r=i.translateY,s=[];p(n)&&n!==0&&s.push("translateX(".concat(n,"px)")),p(r)&&r!==0&&s.push("translateY(".concat(r,"px)")),p(e)&&e!==0&&s.push("rotate(".concat(e,"deg)")),p(t)&&t!==1&&s.push("scaleX(".concat(t,")")),p(a)&&a!==1&&s.push("scaleY(".concat(a,")"));var o=s.length?s.join(" "):"none";return{WebkitTransform:o,msTransform:o,transform:o}}function Aa(i){var e=bt({},i),t=0;return I(i,function(a,n){delete e[n],I(e,function(r){var s=Math.abs(a.startX-r.startX),o=Math.abs(a.startY-r.startY),c=Math.abs(a.endX-r.endX),u=Math.abs(a.endY-r.endY),l=Math.sqrt(s*s+o*o),d=Math.sqrt(c*c+u*u),h=(d-l)/l;Math.abs(h)>Math.abs(t)&&(t=h)})}),t}function we(i,e){var t=i.pageX,a=i.pageY,n={endX:t,endY:a};return e?n:bt({startX:t,startY:a},n)}function Na(i){var e=0,t=0,a=0;return I(i,function(n){var r=n.startX,s=n.startY;e+=r,t+=s,a+=1}),e/=a,t/=a,{pageX:e,pageY:t}}function V(i){var e=i.aspectRatio,t=i.height,a=i.width,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"contain",r=mt(a),s=mt(t);if(r&&s){var o=t*e;n==="contain"&&o>a||n==="cover"&&o<a?t=a/e:a=t*e}else r?t=a/e:s&&(a=t*e);return{width:a,height:t}}function Pa(i){var e=i.width,t=i.height,a=i.degree;if(a=Math.abs(a)%180,a===90)return{width:t,height:e};var n=a%90*Math.PI/180,r=Math.sin(n),s=Math.cos(n),o=e*s+t*r,c=e*r+t*s;return a>90?{width:c,height:o}:{width:o,height:c}}function Oa(i,e,t,a){var n=e.aspectRatio,r=e.naturalWidth,s=e.naturalHeight,o=e.rotate,c=o===void 0?0:o,u=e.scaleX,l=u===void 0?1:u,d=e.scaleY,h=d===void 0?1:d,v=t.aspectRatio,g=t.naturalWidth,w=t.naturalHeight,b=a.fillColor,L=b===void 0?"transparent":b,T=a.imageSmoothingEnabled,D=T===void 0?!0:T,j=a.imageSmoothingQuality,O=j===void 0?"low":j,m=a.maxWidth,y=m===void 0?1/0:m,C=a.maxHeight,R=C===void 0?1/0:C,Y=a.minWidth,Q=Y===void 0?0:Y,Z=a.minHeight,W=Z===void 0?0:Z,H=document.createElement("canvas"),B=H.getContext("2d"),J=V({aspectRatio:v,width:y,height:R}),ye=V({aspectRatio:v,width:Q,height:W},"cover"),De=Math.min(J.width,Math.max(ye.width,g)),Ie=Math.min(J.height,Math.max(ye.height,w)),Xe=V({aspectRatio:n,width:y,height:R}),Ge=V({aspectRatio:n,width:Q,height:W},"cover"),Ve=Math.min(Xe.width,Math.max(Ge.width,r)),Fe=Math.min(Xe.height,Math.max(Ge.height,s)),zt=[-Ve/2,-Fe/2,Ve,Fe];return H.width=de(De),H.height=de(Ie),B.fillStyle=L,B.fillRect(0,0,De,Ie),B.save(),B.translate(De/2,Ie/2),B.rotate(c*Math.PI/180),B.scale(l,h),B.imageSmoothingEnabled=D,B.imageSmoothingQuality=O,B.drawImage.apply(B,[i].concat(xt(zt.map(function(_t){return Math.floor(de(_t))})))),B.restore(),H}var At=String.fromCharCode;function Ra(i,e,t){var a="";t+=e;for(var n=e;n<t;n+=1)a+=At(i.getUint8(n));return a}var $a=/^data:.*,/;function Ua(i){var e=i.replace($a,""),t=atob(e),a=new ArrayBuffer(t.length),n=new Uint8Array(a);return I(n,function(r,s){n[s]=t.charCodeAt(s)}),a}function Ha(i,e){for(var t=[],a=8192,n=new Uint8Array(i);n.length>0;)t.push(At.apply(null,Ct(n.subarray(0,a)))),n=n.subarray(a);return"data:".concat(e,";base64,").concat(btoa(t.join("")))}function za(i){var e=new DataView(i),t;try{var a,n,r;if(e.getUint8(0)===255&&e.getUint8(1)===216)for(var s=e.byteLength,o=2;o+1<s;){if(e.getUint8(o)===255&&e.getUint8(o+1)===225){n=o;break}o+=1}if(n){var c=n+4,u=n+10;if(Ra(e,c,4)==="Exif"){var l=e.getUint16(u);if(a=l===18761,(a||l===19789)&&e.getUint16(u+2,a)===42){var d=e.getUint32(u+4,a);d>=8&&(r=u+d)}}}if(r){var h=e.getUint16(r,a),v,g;for(g=0;g<h;g+=1)if(v=r+g*12+2,e.getUint16(v,a)===274){v+=8,t=e.getUint16(v,a),e.setUint16(v,1,a);break}}}catch{t=1}return t}function _a(i){var e=0,t=1,a=1;switch(i){case 2:t=-1;break;case 3:e=-180;break;case 4:a=-1;break;case 5:e=90,a=-1;break;case 6:e=90;break;case 7:e=90,t=-1;break;case 8:e=-90;break}return{rotate:e,scaleX:t,scaleY:a}}var ja={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.element,t=this.options,a=this.container,n=this.cropper,r=Number(t.minContainerWidth),s=Number(t.minContainerHeight);S(n,N),z(e,N);var o={width:Math.max(a.offsetWidth,r>=0?r:It),height:Math.max(a.offsetHeight,s>=0?s:Lt)};this.containerData=o,G(n,{width:o.width,height:o.height}),S(e,N),z(n,N)},initCanvas:function(){var e=this.containerData,t=this.imageData,a=this.options.viewMode,n=Math.abs(t.rotate)%180===90,r=n?t.naturalHeight:t.naturalWidth,s=n?t.naturalWidth:t.naturalHeight,o=r/s,c=e.width,u=e.height;e.height*o>e.width?a===3?c=e.height*o:u=e.width/o:a===3?u=e.width/o:c=e.height*o;var l={aspectRatio:o,naturalWidth:r,naturalHeight:s,width:c,height:u};this.canvasData=l,this.limited=a===1||a===2,this.limitCanvas(!0,!0),l.width=Math.min(Math.max(l.width,l.minWidth),l.maxWidth),l.height=Math.min(Math.max(l.height,l.minHeight),l.maxHeight),l.left=(e.width-l.width)/2,l.top=(e.height-l.height)/2,l.oldLeft=l.left,l.oldTop=l.top,this.initialCanvasData=k({},l)},limitCanvas:function(e,t){var a=this.options,n=this.containerData,r=this.canvasData,s=this.cropBoxData,o=a.viewMode,c=r.aspectRatio,u=this.cropped&&s;if(e){var l=Number(a.minCanvasWidth)||0,d=Number(a.minCanvasHeight)||0;o>1?(l=Math.max(l,n.width),d=Math.max(d,n.height),o===3&&(d*c>l?l=d*c:d=l/c)):o>0&&(l?l=Math.max(l,u?s.width:0):d?d=Math.max(d,u?s.height:0):u&&(l=s.width,d=s.height,d*c>l?l=d*c:d=l/c));var h=V({aspectRatio:c,width:l,height:d});l=h.width,d=h.height,r.minWidth=l,r.minHeight=d,r.maxWidth=1/0,r.maxHeight=1/0}if(t)if(o>(u?0:1)){var v=n.width-r.width,g=n.height-r.height;r.minLeft=Math.min(0,v),r.minTop=Math.min(0,g),r.maxLeft=Math.max(0,v),r.maxTop=Math.max(0,g),u&&this.limited&&(r.minLeft=Math.min(s.left,s.left+(s.width-r.width)),r.minTop=Math.min(s.top,s.top+(s.height-r.height)),r.maxLeft=s.left,r.maxTop=s.top,o===2&&(r.width>=n.width&&(r.minLeft=Math.min(0,v),r.maxLeft=Math.max(0,v)),r.height>=n.height&&(r.minTop=Math.min(0,g),r.maxTop=Math.max(0,g))))}else r.minLeft=-r.width,r.minTop=-r.height,r.maxLeft=n.width,r.maxTop=n.height},renderCanvas:function(e,t){var a=this.canvasData,n=this.imageData;if(t){var r=Pa({width:n.naturalWidth*Math.abs(n.scaleX||1),height:n.naturalHeight*Math.abs(n.scaleY||1),degree:n.rotate||0}),s=r.width,o=r.height,c=a.width*(s/a.naturalWidth),u=a.height*(o/a.naturalHeight);a.left-=(c-a.width)/2,a.top-=(u-a.height)/2,a.width=c,a.height=u,a.aspectRatio=s/o,a.naturalWidth=s,a.naturalHeight=o,this.limitCanvas(!0,!1)}(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,G(this.canvas,k({width:a.width,height:a.height},pe({translateX:a.left,translateY:a.top}))),this.renderImage(e),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(e){var t=this.canvasData,a=this.imageData,n=a.naturalWidth*(t.width/t.naturalWidth),r=a.naturalHeight*(t.height/t.naturalHeight);k(a,{width:n,height:r,left:(t.width-n)/2,top:(t.height-r)/2}),G(this.image,k({width:a.width,height:a.height},pe(k({translateX:a.left,translateY:a.top},a)))),e&&this.output()},initCropBox:function(){var e=this.options,t=this.canvasData,a=e.aspectRatio||e.initialAspectRatio,n=Number(e.autoCropArea)||.8,r={width:t.width,height:t.height};a&&(t.height*a>t.width?r.height=r.width/a:r.width=r.height*a),this.cropBoxData=r,this.limitCropBox(!0,!0),r.width=Math.min(Math.max(r.width,r.minWidth),r.maxWidth),r.height=Math.min(Math.max(r.height,r.minHeight),r.maxHeight),r.width=Math.max(r.minWidth,r.width*n),r.height=Math.max(r.minHeight,r.height*n),r.left=t.left+(t.width-r.width)/2,r.top=t.top+(t.height-r.height)/2,r.oldLeft=r.left,r.oldTop=r.top,this.initialCropBoxData=k({},r)},limitCropBox:function(e,t){var a=this.options,n=this.containerData,r=this.canvasData,s=this.cropBoxData,o=this.limited,c=a.aspectRatio;if(e){var u=Number(a.minCropBoxWidth)||0,l=Number(a.minCropBoxHeight)||0,d=o?Math.min(n.width,r.width,r.width+r.left,n.width-r.left):n.width,h=o?Math.min(n.height,r.height,r.height+r.top,n.height-r.top):n.height;u=Math.min(u,n.width),l=Math.min(l,n.height),c&&(u&&l?l*c>u?l=u/c:u=l*c:u?l=u/c:l&&(u=l*c),h*c>d?h=d/c:d=h*c),s.minWidth=Math.min(u,d),s.minHeight=Math.min(l,h),s.maxWidth=d,s.maxHeight=h}t&&(o?(s.minLeft=Math.max(0,r.left),s.minTop=Math.max(0,r.top),s.maxLeft=Math.min(n.width,r.left+r.width)-s.width,s.maxTop=Math.min(n.height,r.top+r.height)-s.height):(s.minLeft=0,s.minTop=0,s.maxLeft=n.width-s.width,s.maxTop=n.height-s.height))},renderCropBox:function(){var e=this.options,t=this.containerData,a=this.cropBoxData;(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=Math.min(Math.max(a.width,a.minWidth),a.maxWidth),a.height=Math.min(Math.max(a.height,a.minHeight),a.maxHeight),this.limitCropBox(!1,!0),a.left=Math.min(Math.max(a.left,a.minLeft),a.maxLeft),a.top=Math.min(Math.max(a.top,a.minTop),a.maxTop),a.oldLeft=a.left,a.oldTop=a.top,e.movable&&e.cropBoxMovable&&ve(this.face,ge,a.width>=t.width&&a.height>=t.height?Et:je),G(this.cropBox,k({width:a.width,height:a.height},pe({translateX:a.left,translateY:a.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),ce(this.element,Ne,this.getData())}},Ya={initPreview:function(){var e=this.element,t=this.crossOrigin,a=this.options.preview,n=t?this.crossOriginUrl:this.url,r=e.alt||"The image to preview",s=document.createElement("img");if(t&&(s.crossOrigin=t),s.src=n,s.alt=r,this.viewBox.appendChild(s),this.viewBoxImage=s,!!a){var o=a;typeof a=="string"?o=e.ownerDocument.querySelectorAll(a):a.querySelector&&(o=[a]),this.previews=o,I(o,function(c){var u=document.createElement("img");ve(c,xe,{width:c.offsetWidth,height:c.offsetHeight,html:c.innerHTML}),t&&(u.crossOrigin=t),u.src=n,u.alt=r,u.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',c.innerHTML="",c.appendChild(u)})}},resetPreview:function(){I(this.previews,function(e){var t=Ue(e,xe);G(e,{width:t.width,height:t.height}),e.innerHTML=t.html,Sa(e,xe)})},preview:function(){var e=this.imageData,t=this.canvasData,a=this.cropBoxData,n=a.width,r=a.height,s=e.width,o=e.height,c=a.left-t.left-e.left,u=a.top-t.top-e.top;!this.cropped||this.disabled||(G(this.viewBoxImage,k({width:s,height:o},pe(k({translateX:-c,translateY:-u},e)))),I(this.previews,function(l){var d=Ue(l,xe),h=d.width,v=d.height,g=h,w=v,b=1;n&&(b=h/n,w=r*b),r&&w>v&&(b=v/r,g=n*b,w=v),G(l,{width:g,height:w}),G(l.getElementsByTagName("img")[0],k({width:s*b,height:o*b},pe(k({translateX:-c*b,translateY:-u*b},e))))}))}},Wa={bind:function(){var e=this.element,t=this.options,a=this.cropper;A(t.cropstart)&&$(e,Re,t.cropstart),A(t.cropmove)&&$(e,Oe,t.cropmove),A(t.cropend)&&$(e,Pe,t.cropend),A(t.crop)&&$(e,Ne,t.crop),A(t.zoom)&&$(e,$e,t.zoom),$(a,nt,this.onCropStart=this.cropStart.bind(this)),t.zoomable&&t.zoomOnWheel&&$(a,ct,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&$(a,rt,this.onDblclick=this.dblclick.bind(this)),$(e.ownerDocument,st,this.onCropMove=this.cropMove.bind(this)),$(e.ownerDocument,ot,this.onCropEnd=this.cropEnd.bind(this)),t.responsive&&$(window,dt,this.onResize=this.resize.bind(this))},unbind:function(){var e=this.element,t=this.options,a=this.cropper;A(t.cropstart)&&U(e,Re,t.cropstart),A(t.cropmove)&&U(e,Oe,t.cropmove),A(t.cropend)&&U(e,Pe,t.cropend),A(t.crop)&&U(e,Ne,t.crop),A(t.zoom)&&U(e,$e,t.zoom),U(a,nt,this.onCropStart),t.zoomable&&t.zoomOnWheel&&U(a,ct,this.onWheel,{passive:!1,capture:!0}),t.toggleDragModeOnDblclick&&U(a,rt,this.onDblclick),U(e.ownerDocument,st,this.onCropMove),U(e.ownerDocument,ot,this.onCropEnd),t.responsive&&U(window,dt,this.onResize)}},qa={resize:function(){if(!this.disabled){var e=this.options,t=this.container,a=this.containerData,n=t.offsetWidth/a.width,r=t.offsetHeight/a.height,s=Math.abs(n-1)>Math.abs(r-1)?n:r;if(s!==1){var o,c;e.restore&&(o=this.getCanvasData(),c=this.getCropBoxData()),this.render(),e.restore&&(this.setCanvasData(I(o,function(u,l){o[l]=u*s})),this.setCropBoxData(I(c,function(u,l){c[l]=u*s})))}}},dblclick:function(){this.disabled||this.options.dragMode===Dt||this.setDragMode(Ca(this.dragBox,Be)?Mt:Ye)},wheel:function(e){var t=this,a=Number(this.options.wheelZoomRatio)||.1,n=1;this.disabled||(e.preventDefault(),!this.wheeling&&(this.wheeling=!0,setTimeout(function(){t.wheeling=!1},50),e.deltaY?n=e.deltaY>0?1:-1:e.wheelDelta?n=-e.wheelDelta/120:e.detail&&(n=e.detail>0?1:-1),this.zoom(-n*a,e)))},cropStart:function(e){var t=e.buttons,a=e.button;if(!(this.disabled||(e.type==="mousedown"||e.type==="pointerdown"&&e.pointerType==="mouse")&&(p(t)&&t!==1||p(a)&&a!==0||e.ctrlKey))){var n=this.options,r=this.pointers,s;e.changedTouches?I(e.changedTouches,function(o){r[o.identifier]=we(o)}):r[e.pointerId||0]=we(e),Object.keys(r).length>1&&n.zoomable&&n.zoomOnTouch?s=kt:s=Ue(e.target,ge),ba.test(s)&&ce(this.element,Re,{originalEvent:e,action:s})!==!1&&(e.preventDefault(),this.action=s,this.cropping=!1,s===wt&&(this.cropping=!0,S(this.dragBox,Ee)))}},cropMove:function(e){var t=this.action;if(!(this.disabled||!t)){var a=this.pointers;e.preventDefault(),ce(this.element,Oe,{originalEvent:e,action:t})!==!1&&(e.changedTouches?I(e.changedTouches,function(n){k(a[n.identifier]||{},we(n,!0))}):k(a[e.pointerId||0]||{},we(e,!0)),this.change(e))}},cropEnd:function(e){if(!this.disabled){var t=this.action,a=this.pointers;e.changedTouches?I(e.changedTouches,function(n){delete a[n.identifier]}):delete a[e.pointerId||0],t&&(e.preventDefault(),Object.keys(a).length||(this.action=""),this.cropping&&(this.cropping=!1,oe(this.dragBox,Ee,this.cropped&&this.options.modal)),ce(this.element,Pe,{originalEvent:e,action:t}))}}},Xa={change:function(e){var t=this.options,a=this.canvasData,n=this.containerData,r=this.cropBoxData,s=this.pointers,o=this.action,c=t.aspectRatio,u=r.left,l=r.top,d=r.width,h=r.height,v=u+d,g=l+h,w=0,b=0,L=n.width,T=n.height,D=!0,j;!c&&e.shiftKey&&(c=d&&h?d/h:1),this.limited&&(w=r.minLeft,b=r.minTop,L=w+Math.min(n.width,a.width,a.left+a.width),T=b+Math.min(n.height,a.height,a.top+a.height));var O=s[Object.keys(s)[0]],m={x:O.endX-O.startX,y:O.endY-O.startY},y=function(R){switch(R){case ee:v+m.x>L&&(m.x=L-v);break;case te:u+m.x<w&&(m.x=w-u);break;case q:l+m.y<b&&(m.y=b-l);break;case ne:g+m.y>T&&(m.y=T-g);break}};switch(o){case je:u+=m.x,l+=m.y;break;case ee:if(m.x>=0&&(v>=L||c&&(l<=b||g>=T))){D=!1;break}y(ee),d+=m.x,d<0&&(o=te,d=-d,u-=d),c&&(h=d/c,l+=(r.height-h)/2);break;case q:if(m.y<=0&&(l<=b||c&&(u<=w||v>=L))){D=!1;break}y(q),h-=m.y,l+=m.y,h<0&&(o=ne,h=-h,l-=h),c&&(d=h*c,u+=(r.width-d)/2);break;case te:if(m.x<=0&&(u<=w||c&&(l<=b||g>=T))){D=!1;break}y(te),d-=m.x,u+=m.x,d<0&&(o=ee,d=-d,u-=d),c&&(h=d/c,l+=(r.height-h)/2);break;case ne:if(m.y>=0&&(g>=T||c&&(u<=w||v>=L))){D=!1;break}y(ne),h+=m.y,h<0&&(o=q,h=-h,l-=h),c&&(d=h*c,u+=(r.width-d)/2);break;case ue:if(c){if(m.y<=0&&(l<=b||v>=L)){D=!1;break}y(q),h-=m.y,l+=m.y,d=h*c}else y(q),y(ee),m.x>=0?v<L?d+=m.x:m.y<=0&&l<=b&&(D=!1):d+=m.x,m.y<=0?l>b&&(h-=m.y,l+=m.y):(h-=m.y,l+=m.y);d<0&&h<0?(o=fe,h=-h,d=-d,l-=h,u-=d):d<0?(o=he,d=-d,u-=d):h<0&&(o=me,h=-h,l-=h);break;case he:if(c){if(m.y<=0&&(l<=b||u<=w)){D=!1;break}y(q),h-=m.y,l+=m.y,d=h*c,u+=r.width-d}else y(q),y(te),m.x<=0?u>w?(d-=m.x,u+=m.x):m.y<=0&&l<=b&&(D=!1):(d-=m.x,u+=m.x),m.y<=0?l>b&&(h-=m.y,l+=m.y):(h-=m.y,l+=m.y);d<0&&h<0?(o=me,h=-h,d=-d,l-=h,u-=d):d<0?(o=ue,d=-d,u-=d):h<0&&(o=fe,h=-h,l-=h);break;case fe:if(c){if(m.x<=0&&(u<=w||g>=T)){D=!1;break}y(te),d-=m.x,u+=m.x,h=d/c}else y(ne),y(te),m.x<=0?u>w?(d-=m.x,u+=m.x):m.y>=0&&g>=T&&(D=!1):(d-=m.x,u+=m.x),m.y>=0?g<T&&(h+=m.y):h+=m.y;d<0&&h<0?(o=ue,h=-h,d=-d,l-=h,u-=d):d<0?(o=me,d=-d,u-=d):h<0&&(o=he,h=-h,l-=h);break;case me:if(c){if(m.x>=0&&(v>=L||g>=T)){D=!1;break}y(ee),d+=m.x,h=d/c}else y(ne),y(ee),m.x>=0?v<L?d+=m.x:m.y>=0&&g>=T&&(D=!1):d+=m.x,m.y>=0?g<T&&(h+=m.y):h+=m.y;d<0&&h<0?(o=he,h=-h,d=-d,l-=h,u-=d):d<0?(o=fe,d=-d,u-=d):h<0&&(o=ue,h=-h,l-=h);break;case Et:this.move(m.x,m.y),D=!1;break;case kt:this.zoom(Aa(s),e),D=!1;break;case wt:if(!m.x||!m.y){D=!1;break}j=Bt(this.cropper),u=O.startX-j.left,l=O.startY-j.top,d=r.minWidth,h=r.minHeight,m.x>0?o=m.y>0?me:ue:m.x<0&&(u-=d,o=m.y>0?fe:he),m.y<0&&(l-=h),this.cropped||(z(this.cropBox,N),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break}D&&(r.width=d,r.height=h,r.left=u,r.top=l,this.action=o,this.renderCropBox()),I(s,function(C){C.startX=C.endX,C.startY=C.endY})}},Ga={crop:function(){return this.ready&&!this.cropped&&!this.disabled&&(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&S(this.dragBox,Ee),z(this.cropBox,N),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=k({},this.initialImageData),this.canvasData=k({},this.initialCanvasData),this.cropBoxData=k({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(k(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),z(this.dragBox,Ee),S(this.cropBox,N)),this},replace:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return!this.disabled&&e&&(this.isImg&&(this.element.src=e),t?(this.url=e,this.image.src=e,this.ready&&(this.viewBoxImage.src=e,I(this.previews,function(a){a.getElementsByTagName("img")[0].src=e}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(e))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,z(this.cropper,at)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,S(this.cropper,at)),this},destroy:function(){var e=this.element;return e[E]?(e[E]=void 0,this.isImg&&this.replaced&&(e.src=this.originalUrl),this.uncreate(),this):this},move:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,a=this.canvasData,n=a.left,r=a.top;return this.moveTo(Le(e)?e:n+Number(e),Le(t)?t:r+Number(t))},moveTo:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,a=this.canvasData,n=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.movable&&(p(e)&&(a.left=e,n=!0),p(t)&&(a.top=t,n=!0),n&&this.renderCanvas(!0)),this},zoom:function(e,t){var a=this.canvasData;return e=Number(e),e<0?e=1/(1-e):e=1+e,this.zoomTo(a.width*e/a.naturalWidth,null,t)},zoomTo:function(e,t,a){var n=this.options,r=this.canvasData,s=r.width,o=r.height,c=r.naturalWidth,u=r.naturalHeight;if(e=Number(e),e>=0&&this.ready&&!this.disabled&&n.zoomable){var l=c*e,d=u*e;if(ce(this.element,$e,{ratio:e,oldRatio:s/c,originalEvent:a})===!1)return this;if(a){var h=this.pointers,v=Bt(this.cropper),g=h&&Object.keys(h).length?Na(h):{pageX:a.pageX,pageY:a.pageY};r.left-=(l-s)*((g.pageX-v.left-r.left)/s),r.top-=(d-o)*((g.pageY-v.top-r.top)/o)}else se(t)&&p(t.x)&&p(t.y)?(r.left-=(l-s)*((t.x-r.left)/s),r.top-=(d-o)*((t.y-r.top)/o)):(r.left-=(l-s)/2,r.top-=(d-o)/2);r.width=l,r.height=d,this.renderCanvas(!0)}return this},rotate:function(e){return this.rotateTo((this.imageData.rotate||0)+Number(e))},rotateTo:function(e){return e=Number(e),p(e)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=e%360,this.renderCanvas(!0,!0)),this},scaleX:function(e){var t=this.imageData.scaleY;return this.scale(e,p(t)?t:1)},scaleY:function(e){var t=this.imageData.scaleX;return this.scale(p(t)?t:1,e)},scale:function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e,a=this.imageData,n=!1;return e=Number(e),t=Number(t),this.ready&&!this.disabled&&this.options.scalable&&(p(e)&&(a.scaleX=e,n=!0),p(t)&&(a.scaleY=t,n=!0),n&&this.renderCanvas(!0,!0)),this},getData:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=this.options,a=this.imageData,n=this.canvasData,r=this.cropBoxData,s;if(this.ready&&this.cropped){s={x:r.left-n.left,y:r.top-n.top,width:r.width,height:r.height};var o=a.width/a.naturalWidth;if(I(s,function(l,d){s[d]=l/o}),e){var c=Math.round(s.y+s.height),u=Math.round(s.x+s.width);s.x=Math.round(s.x),s.y=Math.round(s.y),s.width=u-s.x,s.height=c-s.y}}else s={x:0,y:0,width:0,height:0};return t.rotatable&&(s.rotate=a.rotate||0),t.scalable&&(s.scaleX=a.scaleX||1,s.scaleY=a.scaleY||1),s},setData:function(e){var t=this.options,a=this.imageData,n=this.canvasData,r={};if(this.ready&&!this.disabled&&se(e)){var s=!1;t.rotatable&&p(e.rotate)&&e.rotate!==a.rotate&&(a.rotate=e.rotate,s=!0),t.scalable&&(p(e.scaleX)&&e.scaleX!==a.scaleX&&(a.scaleX=e.scaleX,s=!0),p(e.scaleY)&&e.scaleY!==a.scaleY&&(a.scaleY=e.scaleY,s=!0)),s&&this.renderCanvas(!0,!0);var o=a.width/a.naturalWidth;p(e.x)&&(r.left=e.x*o+n.left),p(e.y)&&(r.top=e.y*o+n.top),p(e.width)&&(r.width=e.width*o),p(e.height)&&(r.height=e.height*o),this.setCropBoxData(r)}return this},getContainerData:function(){return this.ready?k({},this.containerData):{}},getImageData:function(){return this.sized?k({},this.imageData):{}},getCanvasData:function(){var e=this.canvasData,t={};return this.ready&&I(["left","top","width","height","naturalWidth","naturalHeight"],function(a){t[a]=e[a]}),t},setCanvasData:function(e){var t=this.canvasData,a=t.aspectRatio;return this.ready&&!this.disabled&&se(e)&&(p(e.left)&&(t.left=e.left),p(e.top)&&(t.top=e.top),p(e.width)?(t.width=e.width,t.height=e.width/a):p(e.height)&&(t.height=e.height,t.width=e.height*a),this.renderCanvas(!0)),this},getCropBoxData:function(){var e=this.cropBoxData,t;return this.ready&&this.cropped&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCropBoxData:function(e){var t=this.cropBoxData,a=this.options.aspectRatio,n,r;return this.ready&&this.cropped&&!this.disabled&&se(e)&&(p(e.left)&&(t.left=e.left),p(e.top)&&(t.top=e.top),p(e.width)&&e.width!==t.width&&(n=!0,t.width=e.width),p(e.height)&&e.height!==t.height&&(r=!0,t.height=e.height),a&&(n?t.height=t.width/a:r&&(t.width=t.height*a)),this.renderCropBox()),this},getCroppedCanvas:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var t=this.canvasData,a=Oa(this.image,this.imageData,t,e);if(!this.cropped)return a;var n=this.getData(e.rounded),r=n.x,s=n.y,o=n.width,c=n.height,u=a.width/Math.floor(t.naturalWidth);u!==1&&(r*=u,s*=u,o*=u,c*=u);var l=o/c,d=V({aspectRatio:l,width:e.maxWidth||1/0,height:e.maxHeight||1/0}),h=V({aspectRatio:l,width:e.minWidth||0,height:e.minHeight||0},"cover"),v=V({aspectRatio:l,width:e.width||(u!==1?a.width:o),height:e.height||(u!==1?a.height:c)}),g=v.width,w=v.height;g=Math.min(d.width,Math.max(h.width,g)),w=Math.min(d.height,Math.max(h.height,w));var b=document.createElement("canvas"),L=b.getContext("2d");b.width=de(g),b.height=de(w),L.fillStyle=e.fillColor||"transparent",L.fillRect(0,0,g,w);var T=e.imageSmoothingEnabled,D=T===void 0?!0:T,j=e.imageSmoothingQuality;L.imageSmoothingEnabled=D,j&&(L.imageSmoothingQuality=j);var O=a.width,m=a.height,y=r,C=s,R,Y,Q,Z,W,H;y<=-o||y>O?(y=0,R=0,Q=0,W=0):y<=0?(Q=-y,y=0,R=Math.min(O,o+y),W=R):y<=O&&(Q=0,R=Math.min(o,O-y),W=R),R<=0||C<=-c||C>m?(C=0,Y=0,Z=0,H=0):C<=0?(Z=-C,C=0,Y=Math.min(m,c+C),H=Y):C<=m&&(Z=0,Y=Math.min(c,m-C),H=Y);var B=[y,C,R,Y];if(W>0&&H>0){var J=g/o;B.push(Q*J,Z*J,W*J,H*J)}return L.drawImage.apply(L,[a].concat(xt(B.map(function(ye){return Math.floor(de(ye))})))),b},setAspectRatio:function(e){var t=this.options;return!this.disabled&&!Le(e)&&(t.aspectRatio=Math.max(0,e)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(e){var t=this.options,a=this.dragBox,n=this.face;if(this.ready&&!this.disabled){var r=e===Ye,s=t.movable&&e===Mt;e=r||s?e:Dt,t.dragMode=e,ve(a,ge,e),oe(a,Be,r),oe(a,Ae,s),t.cropBoxMovable||(ve(n,ge,e),oe(n,Be,r),oe(n,Ae,s))}return this}},Va=_.Cropper,Nt=(function(){function i(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(oa(this,i),!e||!wa.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=k({},ht,se(t)&&t),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return la(i,[{key:"init",value:function(){var t=this.element,a=t.tagName.toLowerCase(),n;if(!t[E]){if(t[E]=this,a==="img"){if(this.isImg=!0,n=t.getAttribute("src")||"",this.originalUrl=n,!n)return;n=t.src}else a==="canvas"&&window.HTMLCanvasElement&&(n=t.toDataURL());this.load(n)}}},{key:"load",value:function(t){var a=this;if(t){this.url=t,this.imageData={};var n=this.element,r=this.options;if(!r.rotatable&&!r.scalable&&(r.checkOrientation=!1),!r.checkOrientation||!window.ArrayBuffer){this.clone();return}if(ya.test(t)){xa.test(t)?this.read(Ua(t)):this.clone();return}var s=new XMLHttpRequest,o=this.clone.bind(this);this.reloading=!0,this.xhr=s,s.onabort=o,s.onerror=o,s.ontimeout=o,s.onprogress=function(){s.getResponseHeader("content-type")!==ut&&s.abort()},s.onload=function(){a.read(s.response)},s.onloadend=function(){a.reloading=!1,a.xhr=null},r.checkCrossOrigin&&ft(t)&&n.crossOrigin&&(t=pt(t)),s.open("GET",t,!0),s.responseType="arraybuffer",s.withCredentials=n.crossOrigin==="use-credentials",s.send()}}},{key:"read",value:function(t){var a=this.options,n=this.imageData,r=za(t),s=0,o=1,c=1;if(r>1){this.url=Ha(t,ut);var u=_a(r);s=u.rotate,o=u.scaleX,c=u.scaleY}a.rotatable&&(n.rotate=s),a.scalable&&(n.scaleX=o,n.scaleY=c),this.clone()}},{key:"clone",value:function(){var t=this.element,a=this.url,n=t.crossOrigin,r=a;this.options.checkCrossOrigin&&ft(a)&&(n||(n="anonymous"),r=pt(a)),this.crossOrigin=n,this.crossOriginUrl=r;var s=document.createElement("img");n&&(s.crossOrigin=n),s.src=r||a,s.alt=t.alt||"The image to crop",this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),S(s,it),t.parentNode.insertBefore(s,t.nextSibling)}},{key:"start",value:function(){var t=this,a=this.image;a.onload=null,a.onerror=null,this.sizing=!0;var n=_.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(_.navigator.userAgent),r=function(u,l){k(t.imageData,{naturalWidth:u,naturalHeight:l,aspectRatio:u/l}),t.initialImageData=k({},t.imageData),t.sizing=!1,t.sized=!0,t.build()};if(a.naturalWidth&&!n){r(a.naturalWidth,a.naturalHeight);return}var s=document.createElement("img"),o=document.body||document.documentElement;this.sizingImage=s,s.onload=function(){r(s.width,s.height),n||o.removeChild(s)},s.src=a.src,n||(s.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",o.appendChild(s))}},{key:"stop",value:function(){var t=this.image;t.onload=null,t.onerror=null,t.parentNode.removeChild(t),this.image=null}},{key:"build",value:function(){if(!(!this.sized||this.ready)){var t=this.element,a=this.options,n=this.image,r=t.parentNode,s=document.createElement("div");s.innerHTML=Ea;var o=s.querySelector(".".concat(E,"-container")),c=o.querySelector(".".concat(E,"-canvas")),u=o.querySelector(".".concat(E,"-drag-box")),l=o.querySelector(".".concat(E,"-crop-box")),d=l.querySelector(".".concat(E,"-face"));this.container=r,this.cropper=o,this.canvas=c,this.dragBox=u,this.cropBox=l,this.viewBox=o.querySelector(".".concat(E,"-view-box")),this.face=d,c.appendChild(n),S(t,N),r.insertBefore(o,t.nextSibling),z(n,it),this.initPreview(),this.bind(),a.initialAspectRatio=Math.max(0,a.initialAspectRatio)||NaN,a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,S(l,N),a.guides||S(l.getElementsByClassName("".concat(E,"-dashed")),N),a.center||S(l.getElementsByClassName("".concat(E,"-center")),N),a.background&&S(o,"".concat(E,"-bg")),a.highlight||S(d,fa),a.cropBoxMovable&&(S(d,Ae),ve(d,ge,je)),a.cropBoxResizable||(S(l.getElementsByClassName("".concat(E,"-line")),N),S(l.getElementsByClassName("".concat(E,"-point")),N)),this.render(),this.ready=!0,this.setDragMode(a.dragMode),a.autoCrop&&this.crop(),this.setData(a.data),A(a.ready)&&$(t,lt,a.ready,{once:!0}),ce(t,lt)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var t=this.cropper.parentNode;t&&t.removeChild(this.cropper),z(this.element,N)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=Va,i}},{key:"setDefaults",value:function(t){k(ht,se(t)&&t)}}])})();k(Nt.prototype,ja,Ya,Wa,qa,Xa,Ga);function M(i,e){const t=document.getElementById("notification");if(!t)return;const a=document.getElementById("notif-message");a&&(a.textContent=i),t.classList.remove("translate-y-24","opacity-0"),e==="error"?(t.classList.remove("bg-slate-900"),t.classList.add("bg-red-600")):(t.classList.add("bg-slate-900"),t.classList.remove("bg-red-600")),setTimeout(()=>{t.classList.add("translate-y-24","opacity-0")},3e3)}function Fa(i){const e=document.getElementById(i);e&&(e.classList.remove("hidden"),e.classList.add("flex"))}function Ka(i){const e=document.getElementById(i);e&&(e.classList.add("hidden"),e.classList.remove("flex"))}function Qa(){const i=document.getElementById("theme-icon");i&&(localStorage.getItem("dps_theme")==="dark"||!("dps_theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.add("dark"),i.classList.replace("fa-moon","fa-sun")):(document.documentElement.classList.remove("dark"),i.classList.replace("fa-sun","fa-moon")))}function Za(){const i=document.documentElement,e=document.getElementById("theme-icon");i.classList.contains("dark")?(i.classList.remove("dark"),localStorage.setItem("dps_theme","light"),e.classList.replace("fa-sun","fa-moon")):(i.classList.add("dark"),localStorage.setItem("dps_theme","dark"),e.classList.replace("fa-moon","fa-sun"))}function Ja(i){document.querySelectorAll(".section-content").forEach(a=>{a.classList.remove("active"),a.classList.add("hidden")});const e=document.getElementById(i)?i:"home",t=document.getElementById(e);t&&(t.classList.add("active"),t.classList.remove("hidden")),window.scrollTo(0,0),ei(e)}function ei(i){document.querySelectorAll(".nav-link").forEach(e=>{const t=e.getAttribute("onclick");t&&t.includes(i)?(e.classList.add("bg-slate-100","dark:bg-slate-800","text-teal-600","dark:text-teal-400"),e.classList.remove("text-slate-600","dark:text-slate-400")):(e.classList.remove("bg-slate-100","dark:bg-slate-800","text-teal-600","dark:text-teal-400"),e.classList.add("text-slate-600","dark:text-slate-400"))}),document.querySelectorAll(".mobile-nav-link").forEach(e=>{const t=e.getAttribute("onclick");t&&t.includes(i)?(e.classList.add("bg-teal-50","dark:bg-teal-900/30","text-teal-700","dark:text-teal-300"),e.classList.remove("text-slate-600","dark:text-slate-300")):(e.classList.remove("bg-teal-50","dark:bg-teal-900/30","text-teal-700","dark:text-teal-300"),e.classList.add("text-slate-600","dark:text-slate-300"))})}function Pt(){const i=document.getElementById("mobile-menu"),e=document.querySelector("#mobile-menu-btn i");i&&(i.classList.contains("hidden")?(i.classList.remove("hidden"),setTimeout(()=>{i.classList.remove("translate-x-full")},10),e&&(e.classList.remove("fa-bars"),e.classList.add("fa-times"))):(i.classList.add("translate-x-full"),setTimeout(()=>{i.classList.add("hidden")},300),e&&(e.classList.remove("fa-times"),e.classList.add("fa-bars"))))}const He=[{name:"teal",hex:"bg-teal-500",light:"bg-teal-100",text:"text-teal-600"},{name:"blue",hex:"bg-blue-500",light:"bg-blue-100",text:"text-blue-600"},{name:"indigo",hex:"bg-indigo-500",light:"bg-indigo-100",text:"text-indigo-600"},{name:"purple",hex:"bg-purple-500",light:"bg-purple-100",text:"text-purple-600"},{name:"rose",hex:"bg-rose-500",light:"bg-rose-100",text:"text-rose-600"},{name:"amber",hex:"bg-amber-500",light:"bg-amber-100",text:"text-amber-600"}];function ti(){const i=document.getElementById("topics-container");if(i){if(f.topicsData.length===0){i.innerHTML='<div class="col-span-full text-center py-10 text-slate-400">No topics found. Admin can add one.</div>';return}i.innerHTML=f.topicsData.map(e=>{const t=He.find(n=>n.name===e.color)||He[0];let a=f.currentUserRole==="admin"?`<button onclick="window.deleteTopic(event, '${e.id}')" class="absolute top-4 right-4 text-slate-300 hover:text-red-500 transition z-20"><i class="fas fa-trash-alt"></i></button>`:"";return`
            <div onclick="window.openTopicModal('${e.id}')" class="cursor-pointer bg-white dark:bg-slate-800 rounded-2xl overflow-hidden shadow-sm border border-slate-200 dark:border-slate-700 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group relative">
                <div class="h-2 ${t.hex}"></div> <div class="p-6">
                    ${a}
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white group-hover:${t.text} transition-colors">${x(e.title)}</h3>
                        <div class="${t.text} text-xl"><i class="fas ${e.icon}"></i></div>
                    </div>
                    <p class="text-slate-600 dark:text-slate-300 text-sm mb-6 h-10 overflow-hidden">${x(e.desc)}</p>
                    <span class="text-xs font-bold ${t.text} uppercase tracking-wider flex items-center">
                        Read Guide <i class="fas fa-arrow-right ml-1 transform group-hover:translate-x-1 transition-transform"></i>
                    </span>
                </div>
            </div>`}).join("")}}function ai(i,e){document.querySelectorAll(".mentor-filter-btn").forEach(t=>{t.className="mentor-filter-btn px-4 py-1.5 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 rounded-full text-sm font-medium hover:border-teal-500 transition"}),e&&(e.className="mentor-filter-btn px-4 py-1.5 bg-teal-600 text-white rounded-full text-sm font-medium shadow-md hover:bg-teal-700 transition"),be(i)}function be(i="all"){const e=document.getElementById("mentors-container");if(!e)return;const t=i==="all"?f.mentorsData:f.mentorsData.filter(a=>a.tags.includes(i)||a.year===i);if(t.length===0){e.innerHTML='<div class="col-span-full text-center py-10 text-slate-400">No mentors found for this filter.</div>';return}e.innerHTML=t.map(a=>{const n=f.currentUserData&&f.currentUserData.email===a.email,r=f.mentorOverrides[a.email]||{},s=r.quote||a.quote,o=r.tags||a.tags,c=r.photoURL||(n?f.currentUserData.photoURL:null);return`
        <article class="bg-white dark:bg-slate-800 rounded-2xl border border-teal-100 dark:border-slate-700 shadow-sm hover:shadow-md transition flex flex-col justify-between p-6 animate-[fadeIn_0.3s_ease-out] relative group">
            ${f.currentUserData&&f.currentUserData.role==="admin"||n?`
                <button onclick="window.openEditMentorModal('${x(a.email)}')" class="absolute top-4 right-4 text-slate-400 hover:text-teal-500 transition opacity-0 group-hover:opacity-100">
                    <i class="fas fa-pencil-alt"></i>
                </button>
            `:""}

            <header class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center mr-3 overflow-hidden">
                        ${c?`<img src="${c}" class="w-full h-full object-cover">`:'<i class="fas fa-graduation-cap text-slate-400"></i>'}
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800 dark:text-white">${x(a.name)}</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400">${x(a.year)}</p>
                    </div>
                </div>
                <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            </header>
            <p class="text-sm text-slate-600 dark:text-slate-300 italic mb-4">"${x(s)}"</p>
            <div class="flex flex-wrap gap-2 mb-4">
                ${o.map(l=>`<span class="px-2 py-1 text-xs rounded-full bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300">${l}</span>`).join("")}
            </div>
            <button onclick="window.showMentorEmail('${x(a.email)}', '${x(a.name)}')" class="mt-auto w-full border border-teal-500 text-teal-700 dark:text-teal-400 rounded-full py-2 text-sm font-semibold hover:bg-teal-500 hover:text-white transition flex items-center justify-center gap-2">
                <i class="far fa-envelope"></i> Contact Mentor
            </button>
        </article>
    `}).join("")}function Ot(i){const e=new Date,t=new Date(i.date);let a=i.time,n,r;if(a.includes(":")){const o=a.match(/(\d+):(\d+)\s*(AM|PM)?/i);if(o){n=parseInt(o[1]),r=parseInt(o[2]);const c=o[3];c&&c.toUpperCase()==="PM"&&n!==12&&(n+=12),c&&c.toUpperCase()==="AM"&&n===12&&(n=0)}}else n=parseInt(a),r=0;t.setHours(n||0,r||0,0,0);const s=new Date(t.getTime()+(parseInt(i.duration)||60)*6e4);return e>s?{status:"past",label:"Past",class:"bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-400"}:e>=t&&e<=s?{status:"live",label:"Live Now",class:"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400 animate-pulse"}:{status:"upcoming",label:"Upcoming",class:"bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400"}}function ii(){const i=document.getElementById("sessions-container");if(i){if(f.sessionsData.length===0){i.innerHTML='<div class="p-8 text-center text-slate-400">No upcoming sessions scheduled.</div>';return}i.innerHTML=f.sessionsData.map(e=>{const t=new Date(e.date),a=t.getDate(),n=t.toLocaleString("default",{month:"short"}).toUpperCase(),r=Ot(e),[s,o]=e.time.split(":"),c=new Date;c.setHours(s),c.setMinutes(o);const u=c.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});let l="";e.platform==="Google Meet"?l='<img src="assets/google-meet.svg" alt="Meet" class="w-5 h-5 mr-2 inline-block">':e.platform==="Zoom"?l='<i class="fas fa-video mr-2 text-blue-500 text-lg"></i>':e.platform==="Microsoft Teams"?l='<i class="fas fa-users-rectangle mr-2 text-indigo-500 text-lg"></i>':l='<i class="fas fa-video mr-2 text-slate-400"></i>';let d=f.currentUserRole==="admin"?`<div class="flex gap-1">
                <button onclick="window.openEditSessionModal('${e.id}')" class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-slate-700 text-slate-400 hover:text-teal-500 hover:bg-teal-50 dark:hover:bg-teal-900/20 transition">
                    <i class="fas fa-pencil-alt"></i>
                </button>
                <button onclick="window.deleteSession('${e.id}')" class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-slate-700 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition">
                    <i class="fas fa-trash-alt"></i>
                </button>
               </div>`:"",h="";return r.status==="past"?h='<span class="px-5 py-2 bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-400 rounded-lg text-sm font-medium cursor-not-allowed">Ended</span>':r.status==="live"?h=`<a href="${e.link}" target="_blank" class="px-5 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-700 transition shadow-md animate-pulse flex items-center gap-2"><span class="w-2 h-2 bg-white rounded-full"></span>Join Live</a>`:h=`<a href="${e.link}" target="_blank" class="px-5 py-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-lg text-sm font-bold hover:opacity-90 transition shadow-md">Join</a>`,`
        <!-- Mobile Card -->
        <div class="md:hidden flex flex-col p-5 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 mb-4 relative overflow-hidden">
            ${r.status==="past"?'<div class="absolute inset-0 bg-white/50 dark:bg-slate-900/50 z-10 pointer-events-none"></div>':""}
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <div class="bg-slate-50 dark:bg-slate-700/50 text-slate-700 dark:text-slate-300 font-bold rounded-xl p-2.5 w-14 text-center border border-slate-200 dark:border-slate-600">
                        <div class="text-[10px] uppercase tracking-wider text-slate-500 dark:text-slate-400">${n}</div>
                        <div class="text-xl leading-none font-extrabold">${a}</div>
                    </div>
                    <div>
                        <div class="font-bold text-slate-800 dark:text-white">${u}</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400">${e.duration}m duration</div>
                    </div>
                </div>
                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide ${r.class}">
                    ${r.status==="live"?'<span class="w-1.5 h-1.5 bg-current rounded-full mr-1"></span>':""}${r.label}
                </span>
            </div>
            <div class="mb-5">
                <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2 leading-tight">${x(e.title)}</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-3 leading-relaxed">${x(e.desc)}</p>
                <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300 border border-teal-100 dark:border-teal-800">${x(e.tag)}</span>
            </div>
            <div class="space-y-4">
                <div class="flex items-center justify-between text-sm text-slate-600 dark:text-slate-400 pt-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-user-circle text-slate-400 text-xl"></i>
                        <span class="font-medium">${x(e.host)}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        ${l}
                        <span class="font-medium">${e.platform}</span>
                    </div>
                </div>
                <div class="flex gap-2">
                     <div class="flex-1">
                        ${h.replace('class="','class="w-full text-center justify-center py-3 text-base ')}
                    </div>
                    ${f.currentUserRole==="admin"?`
                    <div class="flex gap-2">
                        <button onclick="window.openEditSessionModal('${e.id}')" class="w-12 flex items-center justify-center rounded-lg border border-slate-200 dark:border-slate-700 text-slate-400 hover:text-teal-500 hover:bg-teal-50 dark:hover:bg-teal-900/20 transition">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                        <button onclick="window.deleteSession('${e.id}')" class="w-12 flex items-center justify-center rounded-lg border border-slate-200 dark:border-slate-700 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>`:""}
                </div>
            </div>
        </div>

        <!-- Desktop Row -->
        <div class="hidden md:grid md:grid-cols-12 gap-4 px-6 py-5 hover:bg-slate-50 dark:hover:bg-slate-700/30 transition items-center group ${r.status==="past"?"opacity-60":""} border-b border-slate-100 dark:border-slate-800 last:border-0">
            <div class="md:col-span-2 flex items-center gap-3">
                <div class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold rounded-xl p-2 w-14 text-center border border-slate-200 dark:border-slate-600 relative">
                    <div class="text-[10px] uppercase tracking-wider">${n}</div>
                    <div class="text-xl leading-none">${a}</div>
                </div>
                <div class="text-sm text-slate-500 dark:text-slate-400">
                    ${u}<br><span class="text-xs opacity-70">${e.duration}m</span>
                </div>
            </div>
            <div class="md:col-span-4">
                <div class="flex items-center gap-2 mb-1">
                    <h4 class="font-bold text-slate-800 dark:text-white text-lg">${x(e.title)}</h4>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide ${r.class}">
                        ${r.status==="live"?'<span class="w-1.5 h-1.5 bg-current rounded-full mr-1"></span>':""}${r.label}
                    </span>
                </div>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-1">${x(e.desc)}</p>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300 border border-teal-100 dark:border-teal-800">${x(e.tag)}</span>
            </div>
            <div class="md:col-span-3 flex flex-col justify-center text-sm">
                <div class="flex items-center text-slate-700 dark:text-slate-300 mb-1"><i class="fas fa-user-circle mr-2 text-slate-400 text-xl"></i> ${x(e.host)}</div>
                <div class="flex items-center text-slate-600 dark:text-slate-400">
                    ${l}
                    <span>${e.platform}</span>
                </div>
            </div>
            <div class="md:col-span-3 flex items-center justify-end gap-3">
                ${h}
                ${d}
            </div>
        </div>`}).join(""),ri()}}function ri(){const i=document.getElementById("mobile-sessions-badge");if(!i)return;const e=f.sessionsData.filter(t=>{const a=Ot(t).status;return a==="upcoming"||a==="live"}).length;e>0?(i.textContent=e,i.classList.remove("hidden")):i.classList.add("hidden")}function Rt(){const i=document.getElementById("inbox-container");if(!i)return;const e=f.peerMessages.filter(t=>t.status==="pending");if(e.length===0){i.innerHTML='<div class="p-12 text-center text-slate-400 flex flex-col items-center"><i class="fas fa-inbox text-3xl mb-4"></i><p>No new requests.</p></div>';return}i.innerHTML=e.map(t=>`
        <div class="flex flex-col md:flex-row gap-4 p-5 border-b border-slate-100 dark:border-slate-700/50 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition">
            <div class="flex items-start gap-3 md:w-1/3">
                <div class="w-10 h-10 rounded-full bg-teal-100 dark:bg-teal-900/30 text-teal-600 dark:text-teal-400 flex-shrink-0 flex items-center justify-center font-bold text-sm">${t.name.charAt(0).toUpperCase()}</div>
                <div><h4 class="font-bold text-slate-800 dark:text-white text-sm">${x(t.name)}</h4><p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">${x(t.year)}</p></div>
            </div>
            <div class="md:w-1/4 flex items-center"><span class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-200 text-xs px-2.5 py-1 rounded-md border border-slate-200 dark:border-slate-600">${x(t.topic)}</span></div>
            <div class="flex-1 flex justify-end items-center"><button onclick="window.acceptRequest('${t.id}')" class="bg-teal-600 text-white text-sm font-medium px-4 py-2 rounded-lg shadow-sm hover:bg-teal-700 transition">Accept</button></div>
        </div>`).join("")}function gt(i){const e=document.getElementById("nav-admin-link"),t=document.getElementById("nav-peer-link"),a=document.getElementById("mobile-admin-link"),n=document.getElementById("mobile-peer-link"),r=document.getElementById("admin-controls-btn"),s=document.getElementById("admin-session-controls"),o=document.getElementById("user-profile-dropdown");if([e,t,a,n,r,s].forEach(c=>c&&c.classList.add("hidden")),!i){o&&o.classList.add("hidden");return}if(o&&o.classList.remove("hidden"),i==="admin"?(e&&e.classList.remove("hidden"),a&&a.classList.remove("hidden"),r&&r.classList.remove("hidden"),s&&s.classList.remove("hidden"),si(),M("Admin Access Granted","success")):i==="peer"&&(t&&t.classList.remove("hidden"),n&&n.classList.remove("hidden"),Rt(),M("Peer Mentor Access Granted","success")),f.currentUserData){const c=document.getElementById("mobile-menu-name"),u=document.getElementById("mobile-menu-email"),l=document.getElementById("mobile-menu-avatar");if(c&&(c.textContent=f.currentUserData.name),u&&(u.textContent=f.currentUserData.email),l)if(f.currentUserData.photoURL)l.innerHTML=`<img src="${f.currentUserData.photoURL}" style="width: 100%; height: 100%; object-fit: cover;">`;else{const d=ke(f.currentUserData.name);l.innerHTML=`<span id="mobile-menu-initials">${d}</span>`}}}function ni(){if(!f.currentUserData)return;const i=document.getElementById("user-avatar"),e=document.getElementById("user-display-name"),t=document.getElementById("dropdown-user-name"),a=document.getElementById("dropdown-user-email"),n=document.getElementById("dropdown-user-role"),r=document.getElementById("dropdown-avatar"),s=ke(f.currentUserData.name);if(i&&(f.currentUserData.photoURL?i.innerHTML=`<img src="${f.currentUserData.photoURL}" style="width: 100%; height: 100%; object-fit: cover;">`:i.textContent=s),r&&(f.currentUserData.photoURL?r.innerHTML=`<img src="${f.currentUserData.photoURL}" style="width: 100%; height: 100%; object-fit: cover;">`:r.innerHTML=`<span id="dropdown-avatar-initials">${s}</span>`),e&&(e.textContent=f.currentUserData.name.split(" ")[0]),t&&(t.textContent=f.currentUserData.name),a&&(a.textContent=f.currentUserData.email),n){const o={admin:{label:"Administrator",class:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"},peer:{label:"Peer Mentor",class:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300"},student:{label:"Student",class:"bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-300"}},c=o[f.currentUserData.role]||o.student;n.textContent=c.label,n.className=`inline-flex items-center mt-1.5 px-2 py-0.5 rounded-full text-xs font-medium ${c.class}`}}function $t(i){const e=ke(f.currentUserData?.name||"U"),t=document.getElementById("user-avatar");t&&(i?t.innerHTML=`<img src="${i}" style="width: 100%; height: 100%; object-fit: cover;">`:t.innerHTML=e);const a=document.getElementById("dropdown-avatar");a&&(i?a.innerHTML=`<img src="${i}" style="width: 100%; height: 100%; object-fit: cover;">`:a.innerHTML=`<span id="dropdown-avatar-initials">${e}</span>`);const n=document.getElementById("mobile-menu-avatar");n&&(i?n.innerHTML=`<img src="${i}" style="width: 100%; height: 100%; object-fit: cover;">`:n.innerHTML=`<span id="mobile-menu-initials">${e}</span>`),be()}function si(){const i=document.getElementById("icon-selector");if(i&&i.innerHTML===""){["fa-lightbulb","fa-heart-pulse","fa-brain","fa-graduation-cap","fa-coffee","fa-bed","fa-stopwatch","fa-users","fa-book-open","fa-hand-holding-heart"].forEach(a=>{const n=document.createElement("div");n.className=`icon-option ${a==="fa-lightbulb"?"selected":""}`,n.innerHTML=`<i class="fas ${a}"></i>`,n.onclick=()=>{document.querySelectorAll(".icon-option").forEach(r=>r.classList.remove("selected")),n.classList.add("selected"),document.getElementById("selected-icon").value=a},i.appendChild(n)});const t=document.getElementById("color-selector");He.forEach(a=>{const n=document.createElement("div");n.className=`color-option ${a.hex} ${a.name==="teal"?"selected":""}`,n.onclick=()=>{document.querySelectorAll(".color-option").forEach(r=>r.classList.remove("selected")),n.classList.add("selected"),document.getElementById("selected-color").value=a.name},t.appendChild(n)})}}function oi(){const i=document.createElement("div");i.id="suggest-topic-modal",i.className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-[fadeIn_0.2s_ease-out]";const e=document.documentElement.classList.contains("dark"),t=e?"#1e293b":"#ffffff",a=e?"#f1f5f9":"#1e293b",n=e?"#334155":"#e2e8f0";i.innerHTML=`
        <div style="background: ${t}; border-radius: 1rem; max-width: 28rem; width: 100%; position: relative; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); overflow: hidden;">
            <div style="background: linear-gradient(135deg, #0d9488 0%, #115e59 100%); padding: 1.5rem; text-align: center;">
                <div style="width: 3rem; height: 3rem; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-size: 1.25rem;">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h3 style="color: white; font-weight: bold; font-size: 1.25rem; margin-bottom: 0.25rem;">Suggest a Topic</h3>
                <p style="color: rgba(255,255,255,0.8); font-size: 0.875rem;">Help us improve the learning hub.</p>
                <button onclick="window.closeSuggestTopicModal()" style="position: absolute; top: 1rem; right: 1rem; color: rgba(255,255,255,0.6); background: none; border: none; cursor: pointer; font-size: 1.25rem;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="padding: 1.5rem;">
                <form onsubmit="window.submitSuggestTopic(event)">
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: ${a}; margin-bottom: 0.5rem;">Topic Title</label>
                        <input type="text" id="suggest-title" required placeholder="e.g. Pediatric Nursing" 
                            style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 1px solid ${n}; background: ${e?"#0f172a":"#f8fafc"}; color: ${a}; outline: none;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: ${a}; margin-bottom: 0.5rem;">Why is this important?</label>
                        <textarea id="suggest-reason" rows="3" required placeholder="Briefly explain..." 
                            style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 1px solid ${n}; background: ${e?"#0f172a":"#f8fafc"}; color: ${a}; outline: none; resize: none;"></textarea>
                    </div>
                    <button type="submit" style="width: 100%; background: #0d9488; color: white; font-weight: bold; padding: 0.75rem; border-radius: 0.75rem; border: none; cursor: pointer; transition: background 0.2s;">
                        Submit Suggestion
                    </button>
                </form>
            </div>
        </div>
    `,document.body.appendChild(i)}function li(){document.getElementById("suggest-topic-modal")?.remove()}async function di(i){i.preventDefault();const e=document.getElementById("suggest-title").value,t=document.getElementById("suggest-reason").value;try{await Vt({title:e,reason:t,userEmail:f.currentUserData?f.currentUserData.email:"anonymous"});const a=document.querySelector("#suggest-topic-modal > div");a.innerHTML=`
            <div style="padding: 3rem 1.5rem; text-align: center;">
                <div style="width: 4rem; height: 4rem; background: #dcfce7; color: #16a34a; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 2rem;">
                    <i class="fas fa-check"></i>
                </div>
                <h3 style="color: #16a34a; font-weight: bold; font-size: 1.5rem; margin-bottom: 0.5rem;">Thank You!</h3>
                <p style="color: #64748b; margin-bottom: 1.5rem;">Your suggestion has been sent to the admins.</p>
                <button onclick="window.closeSuggestTopicModal()" style="background: #f1f5f9; color: #475569; font-weight: 600; padding: 0.75rem 2rem; border-radius: 0.75rem; border: none; cursor: pointer;">
                    Close
                </button>
            </div>
        `}catch(a){console.error("Error submitting suggestion:",a),alert("Failed to submit suggestion.")}}function ci(i,e){const t=document.createElement("div");t.id="dynamic-modal",t.className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-[fadeIn_0.2s_ease-out]",document.documentElement.classList.contains("dark"),t.innerHTML=`
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden animate-[popIn_0.3s_cubic-bezier(0.175,0.885,0.32,1.275)]">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                <h3 class="text-xl font-bold text-slate-800 dark:text-white flex items-center gap-3">
                    <span class="w-8 h-8 rounded-lg bg-teal-100 dark:bg-teal-900/30 text-teal-600 dark:text-teal-400 flex items-center justify-center text-sm"><i class="fas fa-book-open"></i></span>
                    ${x(i)}
                </h3>
                <button onclick="window.closeDynamicModal()" class="w-8 h-8 rounded-full flex items-center justify-center text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-600 dark:hover:text-slate-200 transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-8 overflow-y-auto custom-scrollbar prose dark:prose-invert max-w-none">
                ${e}
            </div>
            <div class="p-4 border-t border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 flex justify-end">
                <button onclick="window.closeDynamicModal()" class="px-6 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-xl font-semibold hover:bg-slate-300 dark:hover:bg-slate-600 transition">Close</button>
            </div>
        </div>
    `,document.body.appendChild(t)}function ui(){document.getElementById("dynamic-modal")?.remove()}function hi(i){const e=f.topicsData.find(s=>String(s.id)===String(i));if(!e)return;const t=[{name:"teal",hex:"bg-teal-500",light:"bg-teal-100",text:"text-teal-600"},{name:"blue",hex:"bg-blue-500",light:"bg-blue-100",text:"text-blue-600"},{name:"indigo",hex:"bg-indigo-500",light:"bg-indigo-100",text:"text-indigo-600"},{name:"purple",hex:"bg-purple-500",light:"bg-purple-100",text:"text-purple-600"},{name:"rose",hex:"bg-rose-500",light:"bg-rose-100",text:"text-rose-600"},{name:"amber",hex:"bg-amber-500",light:"bg-amber-100",text:"text-amber-600"}];t.find(s=>s.name===e.color)||t[0];const a=e.content||{};let n="";a.bullets&&a.bullets.length>0&&(n=`
            <div class="mb-6">
                <h4 class="font-bold text-lg mb-2 text-slate-800 dark:text-white">Key Signs & Strategies</h4>
                <ul class="list-disc pl-5 space-y-1 text-slate-600 dark:text-slate-300">
                    ${a.bullets.map(s=>`<li>${x(s)}</li>`).join("")}
                </ul>
            </div>
        `);const r=`
        <div class="space-y-6">
            <p class="text-lg text-slate-700 dark:text-slate-300 leading-relaxed">${x(a.intro||e.desc)}</p>
            ${n}
            <div class="bg-teal-50 dark:bg-teal-900/20 p-4 rounded-xl border border-teal-100 dark:border-teal-800">
                <h4 class="font-bold text-teal-800 dark:text-teal-300 mb-1">Action Step</h4>
                <p class="text-teal-700 dark:text-teal-400">${x(a.action||"Contact a peer mentor for support.")}</p>
            </div>
        </div>
    `;ci(e.title,r)}let P=null;function mi(){const i=document.createElement("div");i.id="profile-picture-modal",i.className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-[fadeIn_0.2s_ease-out]";const e=document.documentElement.classList.contains("dark"),t={bg:e?"#1e293b":"#ffffff",text:e?"#f1f5f9":"#1e293b",textMuted:e?"#94a3b8":"#64748b",border:e?"#334155":"#e2e8f0",primary:"#0d9488"};i.innerHTML=`
        <div class="w-full max-w-md md:max-w-2xl rounded-3xl shadow-2xl overflow-hidden transition-all duration-300" style="background: ${t.bg};">
            <div style="padding: 1.5rem; border-bottom: 1px solid ${t.border}; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="font-weight: bold; font-size: 1.25rem; color: ${t.text};">Update Profile Photo</h3>
                <button onclick="window.closeProfilePictureModal()" style="color: ${t.textMuted}; background: none; border: none; cursor: pointer; font-size: 1.25rem;"><i class="fas fa-times"></i></button>
            </div>
            
            <!-- Step 1: Upload -->
            <div id="profile-upload-step" style="padding: 2rem; display: flex; flex-direction: column; align-items: center; gap: 1.5rem;">
                <div style="width: 8rem; height: 8rem; border-radius: 50%; background: ${e?"#334155":"#f1f5f9"}; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: ${t.textMuted}; border: 2px dashed ${t.border}; overflow: hidden; position: relative;">
                    ${f.currentUserData?.photoURL?`
                        <img src="${f.currentUserData.photoURL}" style="width: 100%; height: 100%; object-fit: cover;">
                    `:`
                        <span style="font-size: 2.5rem; font-weight: 700; color: ${t.primary};">${ke(f.currentUserData?.name||"U")}</span>
                    `}
                </div>
                <div style="text-align: center;">
                    <p style="color: ${t.text}; font-weight: 500; margin-bottom: 0.5rem;">Upload a new photo</p>
                    <p style="color: ${t.textMuted}; font-size: 0.875rem;">JPG or PNG, max 5MB</p>
                </div>
                <label style="background: ${t.primary}; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; cursor: pointer; transition: transform 0.1s;">
                    Choose File
                    <input type="file" id="profile-file-input" accept="image/*" style="display: none;" onchange="window.handleProfileImageSelect(event)">
                </label>
                ${f.currentUserData?.photoURL?`
                    <button onclick="window.removeProfilePicture()" style="color: #ef4444; font-size: 0.875rem; font-weight: 500; background: none; border: none; cursor: pointer; padding: 0.5rem;">
                        Remove Current Photo
                    </button>
                `:""}
            </div>

            <!-- Step 2: Crop (Hidden initially) -->
            <div id="profile-crop-step" class="flex-col h-[500px] md:h-[600px]" style="display: none;">
                <div style="flex: 1; background: #0f172a; overflow: hidden; position: relative;" id="crop-container">
                    <img id="profile-crop-image" style="max-width: 100%; display: block;">
                </div>
                
                <!-- Zoom Slider (Moved Up) -->
                <div style="padding: 1rem 1.5rem 0.5rem; background: ${t.bg}; border-top: 1px solid ${t.border};">
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <i class="fas fa-search-minus" style="color: ${t.textMuted};"></i>
                        <input type="range" id="profile-zoom-slider" min="0" max="1.5" step="0.01" value="0" style="width: 100%; accent-color: ${t.primary};">
                        <i class="fas fa-search-plus" style="color: ${t.textMuted};"></i>
                    </div>
                </div>

                <div style="padding: 1rem 1.5rem 1.5rem; background: ${t.bg}; display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                    <button onclick="window.cancelProfileCrop()" style="padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; color: ${t.textMuted}; background: transparent; border: 1px solid ${t.border}; cursor: pointer;">Cancel</button>
                    <button onclick="window.saveProfilePicture()" style="padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; color: white; background: ${t.primary}; border: none; cursor: pointer; flex: 1;">Save Photo</button>
                </div>
            </div>
            
            <!-- Circular Crop Styles & Teal Branding -->
            <style>
                .cropper-view-box,
                .cropper-face {
                    border-radius: 50%;
                    outline: 2px solid ${t.primary}; /* Teal Outline */
                }
                /* Hide the grid lines for a cleaner look */
                .cropper-dashed, .cropper-point, .cropper-line {
                    opacity: 0;
                }
                /* Make the drag handle invisible but usable */
                .cropper-center {
                    opacity: 0;
                }
                /* Dim the outside area more */
                .cropper-modal {
                    opacity: 0.85;
                    background-color: #0f172a; /* Match container bg for seamless look */
                }
            </style>
            
            <!-- Saving Overlay -->
            <div id="profile-saving-overlay" style="display: none; position: absolute; inset: 0; background: rgba(255,255,255,0.9); align-items: center; justify-content: center; flex-direction: column; gap: 1rem; z-index: 50;">
                <div style="width: 3rem; height: 3rem; border: 3px solid ${t.border}; border-top-color: ${t.primary}; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <p style="color: ${t.text}; font-weight: 600;">Updating Profile...</p>
            </div>
            <style>@keyframes spin { to { transform: rotate(360deg); } }</style>
        </div>
    `,document.body.appendChild(i)}function qe(){P&&(P.destroy(),P=null),document.getElementById("profile-picture-modal")?.remove()}function fi(i){const e=i.target.files[0];e&&pi(e)}function pi(i){if(!i.type.startsWith("image/")){M("Please select an image file","error");return}if(i.size>5*1024*1024){M("Image must be less than 5MB","error");return}const e=new FileReader;e.onload=t=>{document.getElementById("profile-upload-step").style.display="none",document.getElementById("profile-crop-step").style.display="flex";const a=document.getElementById("profile-crop-image");a.src=t.target.result,P&&P.destroy(),P=new Nt(a,{aspectRatio:1,viewMode:1,dragMode:"move",autoCropArea:1,restore:!1,guides:!1,center:!1,highlight:!1,cropBoxMovable:!1,cropBoxResizable:!1,toggleDragModeOnDblclick:!1,background:!1,ready(){const n=document.getElementById("profile-zoom-slider");if(n){n.value=0,n.oninput=o=>{parseFloat(o.target.value);const c=P.getImageData();c.width/c.naturalWidth};const r=P.getImageData(),s=r.width/r.naturalWidth;n.oninput=o=>{const c=parseFloat(o.target.value);P.zoomTo(s*(1+c))}}}})},e.readAsDataURL(i)}function gi(){P&&(P.destroy(),P=null),document.getElementById("profile-crop-step").style.display="none",document.getElementById("profile-upload-step").style.display="flex",document.getElementById("profile-file-input").value=""}async function vi(){if(!P)return;const i=document.getElementById("profile-saving-overlay");i.style.display="flex";try{P.getCroppedCanvas({width:256,height:256,fillColor:"#fff",imageSmoothingEnabled:!0,imageSmoothingQuality:"high"}).toBlob(async e=>{const t=auth.currentUser;if(!t)return;const a=await ra(t.uid,e);await ia(t.uid,{photoURL:a}),f.mentorsData.some(r=>r.email===t.email)&&await vt(t.email,{photoURL:a}),f.currentUserData&&(f.currentUserData.photoURL=a),$t(a),M("Profile picture updated!","success"),qe(),i.style.display="none"},"image/jpeg",.9)}catch(e){console.error("Error saving profile picture:",e),M("Failed to save photo.","error"),i.style.display="none"}}async function bi(){if(confirm("Remove profile picture?"))try{const i=auth.currentUser;i&&await na(i.uid),f.currentUserData&&(f.currentUserData.photoURL=null),$t(null),M("Profile picture removed","success"),qe()}catch(i){console.error(i),M("Failed to remove photo.","error")}}function yi(i){const e=f.mentorsData.find(s=>s.email===i);if(!e)return;const t=f.mentorOverrides[i]||{},a=t.quote||e.quote,n=(t.tags||e.tags).join(", "),r=document.createElement("div");r.id="edit-mentor-modal",r.className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-[fadeIn_0.2s_ease-out]",document.documentElement.classList.contains("dark"),r.innerHTML=`
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[popIn_0.3s_cubic-bezier(0.175,0.885,0.32,1.275)]">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 class="text-xl font-bold text-slate-800 dark:text-white">Edit Mentor Profile</h3>
                <button onclick="document.getElementById('edit-mentor-modal').remove()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Message (Quote)</label>
                    <textarea id="edit-mentor-quote" rows="3" class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-teal-500 transition resize-none">${x(a)}</textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Tags (comma separated)</label>
                    <input type="text" id="edit-mentor-tags" value="${x(n)}" class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-teal-500 transition">
                </div>
            </div>
            <div class="p-6 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3">
                <button onclick="document.getElementById('edit-mentor-modal').remove()" class="px-4 py-2 rounded-xl text-slate-600 dark:text-slate-400 font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition">Cancel</button>
                <button onclick="window.saveMentorDetails('${x(i)}')" class="px-6 py-2 rounded-xl bg-teal-500 text-white font-bold hover:bg-teal-600 shadow-lg shadow-teal-500/30 transition transform hover:scale-105">Save Changes</button>
            </div>
        </div>
    `,document.body.appendChild(r)}async function xi(i){const e=document.getElementById("edit-mentor-quote").value.trim(),t=document.getElementById("edit-mentor-tags").value.split(",").map(a=>a.trim()).filter(a=>a.length>0);f.mentorOverrides[i]||(f.mentorOverrides[i]={}),f.mentorOverrides[i].quote=e,f.mentorOverrides[i].tags=t,be(),document.getElementById("edit-mentor-modal").remove(),M("Profile updated successfully!","success");try{await vt(i,{quote:e,tags:t})}catch(a){console.error("Error saving mentor profile:",a),M("Failed to save changes.","error")}}function wi(i,e){const t=document.createElement("div");t.id="dynamic-mentor-modal",t.className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",t.onclick=s=>{s.target===t&&Ut()};const a=document.documentElement.classList.contains("dark"),n=a?"#1e293b":"#ffffff",r=a?"#f1f5f9":"#1e293b";t.innerHTML=`
        <div style="background: ${n}; border-radius: 1rem; max-width: 24rem; width: 100%; padding: 2rem; text-align: center; position: relative;">
            <button onclick="window.closeMentorEmailModal()" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; cursor: pointer; color: ${r};"><i class="fas fa-times"></i></button>
            <div style="width: 4rem; height: 4rem; border-radius: 50%; background: rgba(20, 184, 166, 0.2); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: #14b8a6; font-size: 1.5rem;"><i class="fas fa-envelope"></i></div>
            <h2 style="font-size: 1.5rem; font-weight: bold; color: ${r}; margin-bottom: 0.5rem;">Contact ${x(e.split(" ")[0])}</h2>
            <p style="color: #64748b; font-size: 0.875rem; margin-bottom: 1.5rem;">Copy the email address below.</p>
            <p style="font-family: monospace; font-weight: 600; color: ${r}; background: ${a?"#334155":"#f1f5f9"}; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem; user-select: all;">${x(i)}</p>
            <button onclick="window.copyMentorEmailDynamic('${x(i)}')" id="copy-mentor-btn" style="width: 100%; background: #14b8a6; color: white; padding: 0.75rem; border-radius: 0.75rem; font-weight: bold; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <i class="fas fa-copy"></i> Copy Email
            </button>
        </div>
    `,document.body.appendChild(t)}function Ut(){document.getElementById("dynamic-mentor-modal")?.remove()}function Ei(i){navigator.clipboard.writeText(i).then(()=>{const e=document.getElementById("copy-mentor-btn");e&&(e.innerHTML='<i class="fas fa-check"></i> Copied!',setTimeout(()=>e.innerHTML='<i class="fas fa-copy"></i> Copy Email',2e3))})}function ki(i){const e=f.sessionsData.find(t=>t.id===i);e&&(document.getElementById("new-session-id").value=e.id,document.getElementById("new-session-title").value=e.title,document.getElementById("new-session-host").value=e.host,document.getElementById("new-session-date").value=e.date,document.getElementById("new-session-time").value=e.time,document.getElementById("new-session-duration").value=e.duration,document.getElementById("new-session-platform").value=e.platform,document.getElementById("new-session-tag").value=e.tag,document.getElementById("new-session-link").value=e.link,document.getElementById("new-session-desc").value=e.desc,document.getElementById("session-modal-title").textContent="Edit Session",document.getElementById("session-modal-submit").textContent="Update Session",document.getElementById("admin-add-session").classList.remove("hidden"))}function Mi(){document.getElementById("new-session-id").value="",document.querySelector("#admin-add-session form").reset(),document.getElementById("session-modal-title").textContent="Schedule New Session",document.getElementById("session-modal-submit").textContent="Schedule Session",document.getElementById("admin-add-session").classList.remove("hidden")}async function Di(i){i.preventDefault();const e=document.getElementById("new-session-id").value,t={title:document.getElementById("new-session-title").value,host:document.getElementById("new-session-host").value,date:document.getElementById("new-session-date").value,time:document.getElementById("new-session-time").value,duration:document.getElementById("new-session-duration").value,platform:document.getElementById("new-session-platform").value,tag:document.getElementById("new-session-tag").value,link:document.getElementById("new-session-link").value,desc:document.getElementById("new-session-desc").value};try{e?(await Qt(e,t),M("Session Updated!","success")):(await Kt(t),M("Session Scheduled!","success")),i.target.reset(),document.getElementById("new-session-id").value="",document.getElementById("admin-add-session").classList.add("hidden")}catch(a){console.error("Error saving session: ",a),alert("Failed to save session.")}}let X=!1,le=[];function Ii(){const i=document.getElementById("breath-btn"),e=document.getElementById("breathing-widget"),t=document.getElementById("breath-text"),a=document.getElementById("breath-instruction");X?(X=!1,le.forEach(clearTimeout),le=[],i.textContent="Start Exercise",i.classList.replace("bg-red-500","bg-teal-600"),i.classList.replace("hover:bg-red-600","hover:bg-teal-700"),e.className="breathing-widget",t.textContent="Ready?",a.textContent="Tap Start",e.offsetWidth):(X=!0,i.textContent="Stop Exercise",i.classList.replace("bg-teal-600","bg-red-500"),i.classList.replace("hover:bg-teal-700","hover:bg-red-600"),Ht(e,t,a))}function Ht(i,e,t){X&&(i.className="breathing-widget inhaling",e.textContent="Inhale...",t.textContent="Breathe in slowly through nose (4s)",le.push(setTimeout(()=>{X&&(i.className="breathing-widget holding",e.textContent="Hold...",t.textContent="Keep lungs full (7s)",le.push(setTimeout(()=>{X&&(i.className="breathing-widget exhaling",e.textContent="Exhale...",t.textContent="Release slowly through mouth (8s)",le.push(setTimeout(()=>{X&&(i.className="breathing-widget resting",e.textContent="Rest...",t.textContent="Relax for a moment (3s)",le.push(setTimeout(()=>{X&&Ht(i,e,t)},3e3)))},8e3)))},7e3)))},4e3)))}let ie="LOGIN";function F(i){ie=i;const e=document.getElementById("auth-title"),t=document.getElementById("auth-desc"),a=document.getElementById("auth-submit-btn"),n=document.getElementById("auth-switch-text"),r=document.getElementById("auth-switch-btn"),s=document.getElementById("name-field-container"),o=document.getElementById("password-field-container"),c=document.getElementById("auth-forgot-btn");c.classList.remove("hidden"),K("auth-email"),K("auth-password"),K("auth-name"),document.getElementById("auth-password")&&(document.getElementById("auth-password").value=""),document.getElementById("auth-name")&&(document.getElementById("auth-name").value=""),i==="SIGNUP"?(e.textContent="Create Account",t.textContent="Join the PeerCircle community.",a.textContent="Sign Up",n.textContent="Already have an account?",r.textContent="Sign In",r.onclick=()=>F("LOGIN"),s.classList.remove("hidden")):i==="LOGIN"?(e.textContent="Welcome Back",t.textContent="Sign in to access resources.",a.textContent="Sign In",n.textContent="New here?",r.textContent="Create Account",r.onclick=()=>F("SIGNUP"),s.classList.add("hidden"),o.classList.remove("hidden")):i==="RESET"&&(e.textContent="Reset Password",t.textContent="Enter your email to receive a reset link.",a.textContent="Send Reset Link",o.classList.add("hidden"),c.classList.add("hidden"),s.classList.add("hidden"),n.textContent="Remembered your password?",r.textContent="Back to Login",r.onclick=()=>F("LOGIN"))}function Li(){F(ie==="LOGIN"?"SIGNUP":"LOGIN")}async function Ci(i){i.preventDefault();const e=document.getElementById("auth-email").value.trim(),t=document.getElementById("auth-password").value,a=document.getElementById("auth-name").value,n=document.getElementById("auth-submit-btn");if(K("auth-email"),K("auth-password"),K("auth-name"),!e.endsWith("@rakmhsu.ac.ae")){ae("auth-email","Access Restricted: Please use your university email (@rakmhsu.ac.ae).");return}n.disabled=!0,n.textContent="Processing...";try{if(ie==="SIGNUP"){const s=(await auth.createUserWithEmailAndPassword(e,t)).user;await aa(s.uid,{name:a,email:e}),await s.sendEmailVerification(),M("Account created! Please verify your email.","success"),await auth.signOut(),F("LOGIN")}else if(ie==="LOGIN"){if(!(await auth.signInWithEmailAndPassword(e,t)).user.emailVerified){ae("auth-email","Please verify your email address to log in."),await auth.signOut(),n.disabled=!1,n.textContent="Sign In";return}}else ie==="RESET"&&(await auth.sendPasswordResetEmail(e),M("Password reset email sent!","success"),F("LOGIN"))}catch(r){switch(console.error(r),r.code){case"auth/email-already-in-use":ae("auth-email","This email is already registered. Please sign in instead.");break;case"auth/invalid-email":ae("auth-email","Please enter a valid email address.");break;case"auth/user-not-found":ae("auth-email","No account found with this email. Please sign up.");break;case"auth/wrong-password":case"auth/invalid-credential":ae("auth-password","Incorrect email or password.");break;case"auth/weak-password":ae("auth-password","Password should be at least 6 characters.");break;case"auth/too-many-requests":M("Too many failed attempts. Please try again later.","error");break;case"auth/network-request-failed":M("Network error. Please check your connection.","error");break;default:M(r.message,"error")}n.disabled=!1,ie==="SIGNUP"?n.textContent="Sign Up":ie==="LOGIN"?n.textContent="Sign In":n.textContent="Send Reset Link"}}function Ti(){const i=document.getElementById("profile-dropdown-menu");i&&i.classList.toggle("hidden")}document.addEventListener("click",i=>{const e=document.getElementById("user-profile-dropdown"),t=document.getElementById("profile-dropdown-menu");e&&t&&!e.contains(i.target)&&t.classList.add("hidden")});async function Si(i){i.preventDefault();const e=document.getElementById("chat-name").value,t=document.getElementById("chat-email")?document.getElementById("chat-email").value:"no-email@test.com",a=document.getElementById("chat-year").value,n=document.getElementById("chat-topic").value,r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(document.getElementById("chat-email")&&!r.test(t)){alert("Please enter a valid student email address.");return}try{await ea({name:e,year:a,topic:n,email:t,time:"Anytime"}),document.getElementById("chat-form-container").classList.add("hidden");const s=document.getElementById("chat-success-container");s.classList.remove("hidden"),s.classList.add("flex"),M("Request Sent Successfully","success")}catch(s){console.error("Error sending request:",s),alert("Failed to send request. Please try again.")}}function Bi(){document.getElementById("chat-success-container").classList.add("hidden"),document.getElementById("chat-success-container").classList.remove("flex"),document.getElementById("chat-form-container").classList.remove("hidden"),document.querySelector("#chat-form-container form").reset()}async function Ai(i){try{const e=auth.currentUser;if(!e)return;await ta(i,e.uid),M("Request Accepted!","success")}catch(e){console.error("Error accepting request:",e),alert("Failed to accept request.")}}document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("auth-email");i&&(i.addEventListener("input",t=>{if(K("auth-email"),i.value.includes(" ")&&(i.value=i.value.replace(/\s/g,"")),t.inputType==="insertText"&&t.data==="@"){const n=i.value;n.includes("@")&&n.split("@")[1]===""&&(i.value=n+"rakmhsu.ac.ae")}const a="rakmhsu.ac.ae";if(i.value.includes(a)){const n=i.value.split(a);n.length>1&&(i.value=n[0]+a)}}),i.addEventListener("blur",()=>{const t=i.value,a="rakmhsu.ac.ae";(t.endsWith(a+a)||t.endsWith("@"+a+a))&&(i.value=t.slice(0,-a.length))}));const e=document.getElementById("auth-password");e&&e.addEventListener("input",()=>{K("auth-password")})});document.addEventListener("DOMContentLoaded",()=>{const i=document.getElementById("toggle-password-btn"),e=document.getElementById("auth-password");i&&e&&i.addEventListener("click",()=>{const t=e.getAttribute("type")==="password"?"text":"password";e.setAttribute("type",t);const a=i.querySelector("i");a&&(a.classList.toggle("fa-eye"),a.classList.toggle("fa-eye-slash"),a.classList.add("far"),a.classList.remove("fas"))})});function ae(i,e){const t=document.getElementById(i),a=document.getElementById(i+"-error");t&&a&&(t.classList.add("border-red-500","focus:border-red-500","focus:ring-red-500"),a.textContent=e,a.classList.remove("hidden"))}function K(i){const e=document.getElementById(i),t=document.getElementById(i+"-error");e&&t&&(e.classList.remove("border-red-500","focus:border-red-500","focus:ring-red-500"),t.classList.add("hidden"),t.textContent="")}document.addEventListener("DOMContentLoaded",()=>{window.scrollTo(0,0),Qa(),auth.onAuthStateChanged(async e=>{if(e){if(console.log("User logged in:",e.email),!e.emailVerified){console.log("Email not verified.");return}let t=await Je(e.uid),a=0;for(;!t.exists&&a<3;)await new Promise(r=>setTimeout(r,500)),t=await Je(e.uid),a++;if(t.exists){const r=t.data();Ke(r.role||"student"),Qe({name:r.name||"Student",email:e.email,role:r.role||"student",photoURL:r.photoURL||null}),M(`Welcome back, ${r.name||"Student"}`,"success")}else Ke("student"),Qe({name:"Student",email:e.email,role:"student",photoURL:null});gt(f.currentUserRole),ni();const n=document.getElementById("loading-screen");n&&(n.classList.add("opacity-0"),setTimeout(()=>n.classList.add("hidden"),500)),document.getElementById("login-modal").classList.add("hidden"),Xt(ti),Ft(ii),Jt(Rt),Ze(f.mentorsData).then(()=>{be()}),window.scrollTo(0,0)}else{console.log("User logged out");const t=document.getElementById("loading-screen");t&&(t.classList.add("opacity-0"),setTimeout(()=>t.classList.add("hidden"),500)),document.getElementById("login-modal").classList.remove("hidden"),Ze(f.mentorsData).then(()=>{be()}),gt(null)}});const i=document.getElementById("mobile-menu-btn");i&&i.addEventListener("click",Pt)});window.toggleTheme=Za;window.showSection=i=>{window.location.hash=i};window.toggleMobileMenu=Pt;window.openModal=Fa;window.closeModal=Ka;window.openTopicModal=hi;window.openSuggestTopicModal=oi;window.closeSuggestTopicModal=li;window.submitSuggestTopic=di;window.closeDynamicModal=ui;window.deleteTopic=async(i,e)=>{if(i.stopPropagation(),confirm("Delete this topic?"))try{await Gt(e),M("Topic deleted.","success")}catch(t){console.error("Error deleting topic: ",t),alert("Failed to delete topic.")}};window.openProfilePictureModal=mi;window.closeProfilePictureModal=qe;window.handleProfileImageSelect=fi;window.saveProfilePicture=vi;window.removeProfilePicture=bi;window.cancelProfileCrop=gi;window.openEditMentorModal=yi;window.saveMentorDetails=xi;window.showMentorEmail=wi;window.closeMentorEmailModal=Ut;window.copyMentorEmailDynamic=Ei;window.filterMentors=ai;window.openEditSessionModal=ki;window.resetSessionModal=Mi;window.handleAddSession=Di;window.deleteSession=async i=>{if(confirm("Cancel and delete this session?"))try{await Zt(i),M("Session cancelled.","success")}catch(e){console.error("Error deleting session: ",e),alert("Failed to delete session.")}};window.logout=()=>{auth.signOut().then(()=>{M("Logged Out","success"),window.location.reload()})};window.handleAuth=Ci;window.setAuthMode=F;window.toggleAuthMode=Li;window.toggleProfileDropdown=Ti;window.toggleBreathing=Ii;window.handleBooking=Si;window.resetChatForm=Bi;window.acceptRequest=Ai;window.addEventListener("hashchange",()=>{const i=window.location.hash.substring(1)||"home";Ja(i)});
