(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const i={mentorsData:[{name:"Meerah Ahmed Alansi",year:"BSN Year 4",email:"meera.22904065@rakmhsu.ac.ae",quote:"Happy to support with clinical placement anxiety and confidence on the ward.",tags:["Clinical Support","Placement Anxiety"]},{name:"Seham Mohammed Abuhatab",year:"BSN Year 4",email:"seham.22904030@rakmhsu.ac.ae",quote:"Let’s talk about balancing life, studies, and clinicals without burning out.",tags:["Stress & Burnout","Time Management"]},{name:"Doaa Mohamed Sharafeldin",year:"BSN Year 4",email:"doaa.22904079@rakmhsu.ac.ae",quote:"Here for exam anxiety, study plans, and last-minute motivation.",tags:["Exam Prep","Study Skills"]},{name:"Khalid Said Islam",year:"BSN Year 4",email:"khalid.22904036@rakmhsu.ac.ae",quote:"Happy to chat about tech tools, note-taking, and keeping organized.",tags:["Study Skills","Time Management"]},{name:"Amina Sulieman Yassin",year:"BSN Year 4",email:"amina.22904026@rakmhsu.ac.ae",quote:"Let’s make pharmacology and pathophysiology feel less scary.",tags:["Pharmacology","Pathophysiology"]},{name:"Haya Hani Al Halabi",year:"BSN Year 3",email:"haya.23904004@rakmhsu.ac.ae",quote:"Supporting you with first clinicals, communication, and reflective practice.",tags:["Clinical Support","Communication"]},{name:"Khalifa Khalid Alshehhi",year:"BSN Year 3",email:"khalifa.23904112@rakmhsu.ac.ae",quote:"Happy to discuss exam strategies and OSCE preparation.",tags:["Exam Prep","OSCE"]},{name:"Abdalqader Abdou",year:"BSN Year 3",email:"abdalqader.23904036@rakmhsu.ac.ae",quote:"We can work together on clinical reasoning and case-based thinking.",tags:["Clinical Reasoning","Case Discussions"]},{name:"Bushra Garallah Ali",year:"BSN Year 2",email:"bushra.24904025@rakmhsu.ac.ae",quote:"Here for first-year nerves, basics, and building your confidence.",tags:["First Year Support","Foundations"]},{name:"Ghofran G A Abuzour",year:"BSN Year 2",email:"ghofran.24904022@rakmhsu.ac.ae",quote:"Happy to help with pharmacology flashcards and study routines.",tags:["Pharmacology","Study Routines"]},{name:"Leen Abdelhakim Toubeh",year:"BSN Year 2",email:"leen.24904034@rakmhsu.ac.ae",quote:"Let’s focus on building study habits that actually work for you.",tags:["Study Skills","Motivation"]},{name:"Raghad Mohammad",year:"BSN Year 2",email:"raghad.24904030@rakmhsu.ac.ae",quote:"Here for stress management, grounding techniques, and check-ins.",tags:["Stress Management","Coping Skills"]},{name:"Haneen Jamal Hjaila",year:"BSN Year 2",email:"haneen.24904019@rakmhsu.ac.ae",quote:"Let’s work on confidence, presentations, and speaking up in class.",tags:["Confidence","Presentations"]}],topicsData:[],sessionsData:[],peerMessages:[],mentorOverrides:{},currentUserRole:"student",currentUserData:null,isSignUpMode:!1};function te(t){i.topicsData=t}function ne(t){i.sessionsData=t}function ae(t){i.peerMessages=t}function se(t){i.mentorOverrides=t}function I(t){i.currentUserRole=t}function L(t){i.currentUserData=t}function N(t){return db.collection("topics").onSnapshot(e=>{const n=e.docs.map(a=>({...a.data(),id:a.id}));te(n),t&&t(n)})}async function oe(t){return await db.collection("topics").doc(t).delete()}async function ie(t){return await db.collection("topic_suggestions").add({...t,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp()})}async function B(t){try{const e=await db.collection("mentor_profiles").get(),n={};e.forEach(s=>{n[s.id]=s.data()});const a=t.map(async s=>{try{if(n[s.email]&&n[s.email].photoURL)return;const o=await db.collection("users").where("email","==",s.email).limit(1).get();if(!o.empty){const r=o.docs[0].data();r.photoURL&&(n[s.email]||(n[s.email]={}),n[s.email].photoURL=r.photoURL)}}catch{}});return await Promise.all(a),se(n),n}catch(e){return console.error("Error fetching mentor profiles:",e),{}}}async function j(t,e){return await db.collection("mentor_profiles").doc(t).set({...e,updatedAt:firebase.firestore.FieldValue.serverTimestamp()},{merge:!0})}function q(t){return db.collection("sessions").orderBy("date","asc").onSnapshot(e=>{const n=e.docs.map(a=>({id:a.id,...a.data()}));ne(n),t&&t(n)})}async function re(t){return await db.collection("sessions").add({...t,createdAt:firebase.firestore.FieldValue.serverTimestamp()})}async function le(t,e){return await db.collection("sessions").doc(t).update({...e,updatedAt:firebase.firestore.FieldValue.serverTimestamp()})}async function de(t){return await db.collection("sessions").doc(t).delete()}function ce(t){return db.collection("requests").orderBy("createdAt","desc").onSnapshot(e=>{const n=e.docs.map(a=>({id:a.id,...a.data()}));ae(n),t&&t(n)})}async function ue(t){return await db.collection("requests").add({...t,status:"pending",createdAt:firebase.firestore.FieldValue.serverTimestamp()})}async function me(t,e){return await db.collection("requests").doc(t).update({status:"accepted",acceptedBy:e||"anonymous",acceptedAt:firebase.firestore.FieldValue.serverTimestamp()})}async function P(t){return await db.collection("users").doc(t).get()}async function ge(t,e){return await db.collection("users").doc(t).set({...e,createdAt:firebase.firestore.FieldValue.serverTimestamp()})}async function fe(t,e){return await db.collection("users").doc(t).update(e)}async function pe(t,e){return await(await storage.ref().child(`users/${t}/profile.jpg`).put(e)).ref.getDownloadURL()}async function be(t){return await db.collection("users").doc(t).update({photoURL:firebase.firestore.FieldValue.delete()})}function c(t){return t?t.replace(/[&<>"']/g,function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return e}}):""}function $(t){if(!t)return"U";const e=t.trim().split(" ");return e.length>=2?(e[0][0]+e[e.length-1][0]).toUpperCase():t.substring(0,2).toUpperCase()}function g(t,e){const n=document.getElementById("notification");if(!n)return;const a=document.getElementById("notif-message");a&&(a.textContent=t),n.classList.remove("translate-y-24","opacity-0"),e==="error"?(n.classList.remove("bg-slate-900"),n.classList.add("bg-red-600")):(n.classList.add("bg-slate-900"),n.classList.remove("bg-red-600")),setTimeout(()=>{n.classList.add("translate-y-24","opacity-0")},3e3)}function he(t){const e=document.getElementById(t);e&&(e.classList.remove("hidden"),e.classList.add("flex"))}function xe(t){const e=document.getElementById(t);e&&(e.classList.add("hidden"),e.classList.remove("flex"))}function ye(){const t=document.getElementById("theme-icon");t&&(localStorage.getItem("dps_theme")==="dark"||!("dps_theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.add("dark"),t.classList.replace("fa-moon","fa-sun")):(document.documentElement.classList.remove("dark"),t.classList.replace("fa-sun","fa-moon")))}function ve(){const t=document.documentElement,e=document.getElementById("theme-icon");t.classList.contains("dark")?(t.classList.remove("dark"),localStorage.setItem("dps_theme","light"),e.classList.replace("fa-sun","fa-moon")):(t.classList.add("dark"),localStorage.setItem("dps_theme","dark"),e.classList.replace("fa-moon","fa-sun"))}function we(t){document.querySelectorAll(".section-content").forEach(a=>{a.classList.remove("active"),a.classList.add("hidden")});const e=document.getElementById(t)?t:"home",n=document.getElementById(e);n&&(n.classList.add("active"),n.classList.remove("hidden")),window.scrollTo(0,0),ke(e)}function ke(t){document.querySelectorAll(".nav-link").forEach(e=>{const n=e.getAttribute("onclick");n&&n.includes(t)?(e.classList.add("bg-slate-100","dark:bg-slate-800","text-teal-600","dark:text-teal-400"),e.classList.remove("text-slate-600","dark:text-slate-400")):(e.classList.remove("bg-slate-100","dark:bg-slate-800","text-teal-600","dark:text-teal-400"),e.classList.add("text-slate-600","dark:text-slate-400"))}),document.querySelectorAll(".mobile-nav-link").forEach(e=>{const n=e.getAttribute("onclick");n&&n.includes(t)?(e.classList.add("bg-teal-50","dark:bg-teal-900/30","text-teal-700","dark:text-teal-300"),e.classList.remove("text-slate-600","dark:text-slate-300")):(e.classList.remove("bg-teal-50","dark:bg-teal-900/30","text-teal-700","dark:text-teal-300"),e.classList.add("text-slate-600","dark:text-slate-300"))})}function H(){const t=document.getElementById("mobile-menu"),e=document.querySelector("#mobile-menu-btn i");t&&(t.classList.contains("hidden")?(t.classList.remove("hidden"),setTimeout(()=>{t.classList.remove("translate-x-full")},10),e&&(e.classList.remove("fa-bars"),e.classList.add("fa-times"))):(t.classList.add("translate-x-full"),setTimeout(()=>{t.classList.add("hidden")},300),e&&(e.classList.remove("fa-times"),e.classList.add("fa-bars"))))}const S=[{name:"teal",hex:"bg-teal-500",light:"bg-teal-100",text:"text-teal-600"},{name:"blue",hex:"bg-blue-500",light:"bg-blue-100",text:"text-blue-600"},{name:"indigo",hex:"bg-indigo-500",light:"bg-indigo-100",text:"text-indigo-600"},{name:"purple",hex:"bg-purple-500",light:"bg-purple-100",text:"text-purple-600"},{name:"rose",hex:"bg-rose-500",light:"bg-rose-100",text:"text-rose-600"},{name:"amber",hex:"bg-amber-500",light:"bg-amber-100",text:"text-amber-600"}];function O(){const t=document.getElementById("topics-container");if(t){if(i.topicsData.length===0){t.innerHTML='<div class="col-span-full text-center py-10 text-slate-400">No topics found. Admin can add one.</div>';return}t.innerHTML=i.topicsData.map(e=>{const n=S.find(s=>s.name===e.color)||S[0];let a=i.currentUserRole==="admin"?`<button onclick="window.deleteTopic(event, '${e.id}')" class="absolute top-4 right-4 text-slate-300 hover:text-red-500 transition z-20"><i class="fas fa-trash-alt"></i></button>`:"";return`
            <div onclick="window.openTopicModal('${e.id}')" class="cursor-pointer bg-white dark:bg-slate-800 rounded-2xl overflow-hidden shadow-sm border border-slate-200 dark:border-slate-700 hover:shadow-lg hover:-translate-y-1 transition-all duration-300 group relative">
                <div class="h-2 ${n.hex}"></div> <div class="p-6">
                    ${a}
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="font-bold text-lg text-slate-800 dark:text-white group-hover:${n.text} transition-colors">${c(e.title)}</h3>
                        <div class="${n.text} text-xl"><i class="fas ${e.icon}"></i></div>
                    </div>
                    <p class="text-slate-600 dark:text-slate-300 text-sm mb-6 h-10 overflow-hidden">${c(e.desc)}</p>
                    <span class="text-xs font-bold ${n.text} uppercase tracking-wider flex items-center">
                        Read Guide <i class="fas fa-arrow-right ml-1 transform group-hover:translate-x-1 transition-transform"></i>
                    </span>
                </div>
            </div>`}).join("")}}function Ee(t,e){document.querySelectorAll(".mentor-filter-btn").forEach(n=>{n.className="mentor-filter-btn px-4 py-1.5 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 border border-slate-200 dark:border-slate-700 rounded-full text-sm font-medium hover:border-teal-500 transition"}),e&&(e.className="mentor-filter-btn px-4 py-1.5 bg-teal-600 text-white rounded-full text-sm font-medium shadow-md hover:bg-teal-700 transition"),v(t)}function v(t="all"){const e=document.getElementById("mentors-container");if(!e)return;const n=t==="all"?i.mentorsData:i.mentorsData.filter(a=>a.tags.includes(t)||a.year===t);if(n.length===0){e.innerHTML='<div class="col-span-full text-center py-10 text-slate-400">No mentors found for this filter.</div>';return}e.innerHTML=n.map(a=>{const s=i.currentUserData&&i.currentUserData.email===a.email,o=i.mentorOverrides[a.email]||{},r=o.quote||a.quote,u=o.tags||a.tags,d=o.photoURL||(s?i.currentUserData.photoURL:null);return`
        <article class="bg-white dark:bg-slate-800 rounded-2xl border border-teal-100 dark:border-slate-700 shadow-sm hover:shadow-md transition flex flex-col justify-between p-6 animate-[fadeIn_0.3s_ease-out] relative group">
            ${i.currentUserData&&i.currentUserData.role==="admin"||s?`
                <button onclick="window.openEditMentorModal('${c(a.email)}')" class="absolute top-4 right-4 text-slate-400 hover:text-teal-500 transition opacity-0 group-hover:opacity-100">
                    <i class="fas fa-pencil-alt"></i>
                </button>
            `:""}

            <header class="flex items-center justify-between mb-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-700 flex items-center justify-center mr-3 overflow-hidden">
                        ${d?`<img src="${d}" class="w-full h-full object-cover">`:'<i class="fas fa-user-nurse text-slate-400"></i>'}
                    </div>
                    <div>
                        <h3 class="font-semibold text-slate-800 dark:text-white">${c(a.name)}</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400">${c(a.year)}</p>
                    </div>
                </div>
                <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            </header>
            <p class="text-sm text-slate-600 dark:text-slate-300 italic mb-4">"${c(r)}"</p>
            <div class="flex flex-wrap gap-2 mb-4">
                ${u.map(m=>`<span class="px-2 py-1 text-xs rounded-full bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300">${m}</span>`).join("")}
            </div>
            <button onclick="window.showMentorEmail('${c(a.email)}', '${c(a.name)}')" class="mt-auto w-full border border-teal-500 text-teal-700 dark:text-teal-400 rounded-full py-2 text-sm font-semibold hover:bg-teal-500 hover:text-white transition flex items-center justify-center gap-2">
                <i class="far fa-envelope"></i> Contact Mentor
            </button>
        </article>
    `}).join("")}function z(t){const e=new Date,n=new Date(t.date);let a=t.time,s,o;if(a.includes(":")){const u=a.match(/(\d+):(\d+)\s*(AM|PM)?/i);if(u){s=parseInt(u[1]),o=parseInt(u[2]);const d=u[3];d&&d.toUpperCase()==="PM"&&s!==12&&(s+=12),d&&d.toUpperCase()==="AM"&&s===12&&(s=0)}}else s=parseInt(a),o=0;n.setHours(s||0,o||0,0,0);const r=new Date(n.getTime()+(parseInt(t.duration)||60)*6e4);return e>r?{status:"past",label:"Past",class:"bg-slate-100 text-slate-500 dark:bg-slate-700 dark:text-slate-400"}:e>=n&&e<=r?{status:"live",label:"Live Now",class:"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400 animate-pulse"}:{status:"upcoming",label:"Upcoming",class:"bg-emerald-100 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400"}}function F(){const t=document.getElementById("sessions-container");if(t){if(i.sessionsData.length===0){t.innerHTML='<div class="p-8 text-center text-slate-400">No upcoming sessions scheduled.</div>';return}t.innerHTML=i.sessionsData.map(e=>{const n=new Date(e.date),a=n.getDate(),s=n.toLocaleString("default",{month:"short"}).toUpperCase(),o=z(e),[r,u]=e.time.split(":"),d=new Date;d.setHours(r),d.setMinutes(u);const f=d.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});let m="";e.platform==="Google Meet"?m='<img src="assets/google-meet.svg" alt="Meet" class="w-5 h-5 mr-2 inline-block">':e.platform==="Zoom"?m='<i class="fas fa-video mr-2 text-blue-500 text-lg"></i>':e.platform==="Microsoft Teams"?m='<i class="fas fa-users-rectangle mr-2 text-indigo-500 text-lg"></i>':m='<i class="fas fa-video mr-2 text-slate-400"></i>';let w=i.currentUserRole==="admin"?`<div class="flex gap-1">
                <button onclick="window.openEditSessionModal('${e.id}')" class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-slate-700 text-slate-400 hover:text-teal-500 hover:bg-teal-50 dark:hover:bg-teal-900/20 transition">
                    <i class="fas fa-pencil-alt"></i>
                </button>
                <button onclick="window.deleteSession('${e.id}')" class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 dark:border-slate-700 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition">
                    <i class="fas fa-trash-alt"></i>
                </button>
               </div>`:"",h="";return o.status==="past"?h='<span class="px-5 py-2 bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-400 rounded-lg text-sm font-medium cursor-not-allowed">Ended</span>':o.status==="live"?h=`<a href="${e.link}" target="_blank" class="px-5 py-2 bg-red-600 text-white rounded-lg text-sm font-bold hover:bg-red-700 transition shadow-md animate-pulse flex items-center gap-2"><span class="w-2 h-2 bg-white rounded-full"></span>Join Live</a>`:h=`<a href="${e.link}" target="_blank" class="px-5 py-2 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-lg text-sm font-bold hover:opacity-90 transition shadow-md">Join</a>`,`
        <!-- Mobile Card -->
        <div class="md:hidden flex flex-col p-5 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 mb-4 relative overflow-hidden">
            ${o.status==="past"?'<div class="absolute inset-0 bg-white/50 dark:bg-slate-900/50 z-10 pointer-events-none"></div>':""}
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <div class="bg-slate-50 dark:bg-slate-700/50 text-slate-700 dark:text-slate-300 font-bold rounded-xl p-2.5 w-14 text-center border border-slate-200 dark:border-slate-600">
                        <div class="text-[10px] uppercase tracking-wider text-slate-500 dark:text-slate-400">${s}</div>
                        <div class="text-xl leading-none font-extrabold">${a}</div>
                    </div>
                    <div>
                        <div class="font-bold text-slate-800 dark:text-white">${f}</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400">${e.duration}m duration</div>
                    </div>
                </div>
                <span class="inline-flex items-center px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide ${o.class}">
                    ${o.status==="live"?'<span class="w-1.5 h-1.5 bg-current rounded-full mr-1"></span>':""}${o.label}
                </span>
            </div>
            <div class="mb-5">
                <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-2 leading-tight">${c(e.title)}</h3>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-3 leading-relaxed">${c(e.desc)}</p>
                <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300 border border-teal-100 dark:border-teal-800">${c(e.tag)}</span>
            </div>
            <div class="space-y-4">
                <div class="flex items-center justify-between text-sm text-slate-600 dark:text-slate-400 pt-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-user-circle text-slate-400 text-xl"></i>
                        <span class="font-medium">${c(e.host)}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        ${m}
                        <span class="font-medium">${e.platform}</span>
                    </div>
                </div>
                <div class="flex gap-2">
                     <div class="flex-1">
                        ${h.replace('class="','class="w-full text-center justify-center py-3 text-base ')}
                    </div>
                    ${i.currentUserRole==="admin"?`
                    <div class="flex gap-2">
                        <button onclick="window.openEditSessionModal('${e.id}')" class="w-12 flex items-center justify-center rounded-lg border border-slate-200 dark:border-slate-700 text-slate-400 hover:text-teal-500 hover:bg-teal-50 dark:hover:bg-teal-900/20 transition">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                        <button onclick="window.deleteSession('${e.id}')" class="w-12 flex items-center justify-center rounded-lg border border-slate-200 dark:border-slate-700 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>`:""}
                </div>
            </div>
        </div>

        <!-- Desktop Row -->
        <div class="hidden md:grid md:grid-cols-12 gap-4 px-6 py-5 hover:bg-slate-50 dark:hover:bg-slate-700/30 transition items-center group ${o.status==="past"?"opacity-60":""} border-b border-slate-100 dark:border-slate-800 last:border-0">
            <div class="md:col-span-2 flex items-center gap-3">
                <div class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold rounded-xl p-2 w-14 text-center border border-slate-200 dark:border-slate-600 relative">
                    <div class="text-[10px] uppercase tracking-wider">${s}</div>
                    <div class="text-xl leading-none">${a}</div>
                </div>
                <div class="text-sm text-slate-500 dark:text-slate-400">
                    ${f}<br><span class="text-xs opacity-70">${e.duration}m</span>
                </div>
            </div>
            <div class="md:col-span-4">
                <div class="flex items-center gap-2 mb-1">
                    <h4 class="font-bold text-slate-800 dark:text-white text-lg">${c(e.title)}</h4>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide ${o.class}">
                        ${o.status==="live"?'<span class="w-1.5 h-1.5 bg-current rounded-full mr-1"></span>':""}${o.label}
                    </span>
                </div>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-1">${c(e.desc)}</p>
                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-teal-50 dark:bg-teal-900/30 text-teal-700 dark:text-teal-300 border border-teal-100 dark:border-teal-800">${c(e.tag)}</span>
            </div>
            <div class="md:col-span-3 flex flex-col justify-center text-sm">
                <div class="flex items-center text-slate-700 dark:text-slate-300 mb-1"><i class="fas fa-user-circle mr-2 text-slate-400 text-xl"></i> ${c(e.host)}</div>
                <div class="flex items-center text-slate-600 dark:text-slate-400">
                    ${m}
                    <span>${e.platform}</span>
                </div>
            </div>
            <div class="md:col-span-3 flex items-center justify-end gap-3">
                ${h}
                ${w}
            </div>
        </div>`}).join(""),Ie()}}function Ie(){const t=document.getElementById("mobile-sessions-badge");if(!t)return;const e=i.sessionsData.filter(n=>{const a=z(n).status;return a==="upcoming"||a==="live"}).length;e>0?(t.textContent=e,t.classList.remove("hidden")):t.classList.add("hidden")}function G(){const t=document.getElementById("inbox-container");if(!t)return;const e=i.peerMessages.filter(n=>n.status==="pending");if(e.length===0){t.innerHTML='<div class="p-12 text-center text-slate-400 flex flex-col items-center"><i class="fas fa-inbox text-3xl mb-4"></i><p>No new requests.</p></div>';return}t.innerHTML=e.map(n=>`
        <div class="flex flex-col md:flex-row gap-4 p-5 border-b border-slate-100 dark:border-slate-700/50 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition">
            <div class="flex items-start gap-3 md:w-1/3">
                <div class="w-10 h-10 rounded-full bg-teal-100 dark:bg-teal-900/30 text-teal-600 dark:text-teal-400 flex-shrink-0 flex items-center justify-center font-bold text-sm">${n.name.charAt(0).toUpperCase()}</div>
                <div><h4 class="font-bold text-slate-800 dark:text-white text-sm">${c(n.name)}</h4><p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">${c(n.year)}</p></div>
            </div>
            <div class="md:w-1/4 flex items-center"><span class="bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-200 text-xs px-2.5 py-1 rounded-md border border-slate-200 dark:border-slate-600">${c(n.topic)}</span></div>
            <div class="flex-1 flex justify-end items-center"><button onclick="window.acceptRequest('${n.id}')" class="bg-teal-600 text-white text-sm font-medium px-4 py-2 rounded-lg shadow-sm hover:bg-teal-700 transition">Accept</button></div>
        </div>`).join("")}function M(t){const e=document.getElementById("nav-admin-link"),n=document.getElementById("nav-peer-link"),a=document.getElementById("mobile-admin-link"),s=document.getElementById("mobile-peer-link"),o=document.getElementById("admin-controls-btn"),r=document.getElementById("admin-session-controls"),u=document.getElementById("user-profile-dropdown");if([e,n,a,s,o,r].forEach(d=>d&&d.classList.add("hidden")),!t){u&&u.classList.add("hidden");return}if(u&&u.classList.remove("hidden"),t==="admin"?(e&&e.classList.remove("hidden"),a&&a.classList.remove("hidden"),o&&o.classList.remove("hidden"),r&&r.classList.remove("hidden"),Le(),g("Admin Access Granted","success")):t==="peer"&&(n&&n.classList.remove("hidden"),s&&s.classList.remove("hidden"),G(),g("Peer Mentor Access Granted","success")),i.currentUserData){const d=document.getElementById("mobile-menu-name"),f=document.getElementById("mobile-menu-email"),m=document.getElementById("mobile-menu-avatar");if(d&&(d.textContent=i.currentUserData.name),f&&(f.textContent=i.currentUserData.email),m)if(i.currentUserData.photoURL)m.innerHTML=`<img src="${i.currentUserData.photoURL}" style="width: 100%; height: 100%; object-fit: cover;">`;else{const w=$(i.currentUserData.name);m.innerHTML=`<span id="mobile-menu-initials">${w}</span>`}}}function Y(){if(!i.currentUserData)return;const t=document.getElementById("user-avatar"),e=document.getElementById("user-display-name"),n=document.getElementById("dropdown-user-name"),a=document.getElementById("dropdown-user-email"),s=document.getElementById("dropdown-user-role"),o=document.getElementById("dropdown-avatar"),r=$(i.currentUserData.name);if(t&&(i.currentUserData.photoURL?t.innerHTML=`<img src="${i.currentUserData.photoURL}" style="width: 100%; height: 100%; object-fit: cover;">`:t.textContent=r),o&&(i.currentUserData.photoURL?o.innerHTML=`<img src="${i.currentUserData.photoURL}" style="width: 100%; height: 100%; object-fit: cover;">`:o.innerHTML=`<span id="dropdown-avatar-initials">${r}</span>`),e&&(e.textContent=i.currentUserData.name.split(" ")[0]),n&&(n.textContent=i.currentUserData.name),a&&(a.textContent=i.currentUserData.email),s){const u={admin:{label:"Administrator",class:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300"},peer:{label:"Peer Mentor",class:"bg-indigo-100 text-indigo-700 dark:bg-indigo-900/30 dark:text-indigo-300"},student:{label:"Student",class:"bg-teal-100 text-teal-700 dark:bg-teal-900/30 dark:text-teal-300"},guest:{label:"Guest",class:"bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-300"}},d=u[i.currentUserData.role]||u.student;s.textContent=d.label,s.className=`inline-flex items-center mt-1.5 px-2 py-0.5 rounded-full text-xs font-medium ${d.class}`}}function _(t){const e=$(i.currentUserData?.name||"U"),n=document.getElementById("user-avatar");n&&(t?n.innerHTML=`<img src="${t}" style="width: 100%; height: 100%; object-fit: cover;">`:n.innerHTML=e);const a=document.getElementById("dropdown-avatar");a&&(t?a.innerHTML=`<img src="${t}" style="width: 100%; height: 100%; object-fit: cover;">`:a.innerHTML=`<span id="dropdown-avatar-initials">${e}</span>`);const s=document.getElementById("mobile-menu-avatar");s&&(t?s.innerHTML=`<img src="${t}" style="width: 100%; height: 100%; object-fit: cover;">`:s.innerHTML=`<span id="mobile-menu-initials">${e}</span>`),v()}function Le(){const t=document.getElementById("icon-selector");if(t&&t.innerHTML===""){["fa-lightbulb","fa-heart-pulse","fa-brain","fa-user-nurse","fa-coffee","fa-bed","fa-stopwatch","fa-users","fa-book-open","fa-hand-holding-heart"].forEach(a=>{const s=document.createElement("div");s.className=`icon-option ${a==="fa-lightbulb"?"selected":""}`,s.innerHTML=`<i class="fas ${a}"></i>`,s.onclick=()=>{document.querySelectorAll(".icon-option").forEach(o=>o.classList.remove("selected")),s.classList.add("selected"),document.getElementById("selected-icon").value=a},t.appendChild(s)});const n=document.getElementById("color-selector");S.forEach(a=>{const s=document.createElement("div");s.className=`color-option ${a.hex} ${a.name==="teal"?"selected":""}`,s.onclick=()=>{document.querySelectorAll(".color-option").forEach(o=>o.classList.remove("selected")),s.classList.add("selected"),document.getElementById("selected-color").value=a.name},n.appendChild(s)})}}function Be(){const t=document.createElement("div");t.id="suggest-topic-modal",t.className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-[fadeIn_0.2s_ease-out]";const e=document.documentElement.classList.contains("dark"),n=e?"#1e293b":"#ffffff",a=e?"#f1f5f9":"#1e293b",s=e?"#334155":"#e2e8f0";t.innerHTML=`
        <div style="background: ${n}; border-radius: 1rem; max-width: 28rem; width: 100%; position: relative; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); overflow: hidden;">
            <div style="background: linear-gradient(135deg, #0d9488 0%, #115e59 100%); padding: 1.5rem; text-align: center;">
                <div style="width: 3rem; height: 3rem; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: white; font-size: 1.25rem;">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <h3 style="color: white; font-weight: bold; font-size: 1.25rem; margin-bottom: 0.25rem;">Suggest a Topic</h3>
                <p style="color: rgba(255,255,255,0.8); font-size: 0.875rem;">Help us improve the learning hub.</p>
                <button onclick="window.closeSuggestTopicModal()" style="position: absolute; top: 1rem; right: 1rem; color: rgba(255,255,255,0.6); background: none; border: none; cursor: pointer; font-size: 1.25rem;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="padding: 1.5rem;">
                <form onsubmit="window.submitSuggestTopic(event)">
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: ${a}; margin-bottom: 0.5rem;">Topic Title</label>
                        <input type="text" id="suggest-title" required placeholder="e.g. Pediatric Nursing" 
                            style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 1px solid ${s}; background: ${e?"#0f172a":"#f8fafc"}; color: ${a}; outline: none;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-size: 0.875rem; font-weight: 500; color: ${a}; margin-bottom: 0.5rem;">Why is this important?</label>
                        <textarea id="suggest-reason" rows="3" required placeholder="Briefly explain..." 
                            style="width: 100%; padding: 0.75rem; border-radius: 0.75rem; border: 1px solid ${s}; background: ${e?"#0f172a":"#f8fafc"}; color: ${a}; outline: none; resize: none;"></textarea>
                    </div>
                    <button type="submit" style="width: 100%; background: #0d9488; color: white; font-weight: bold; padding: 0.75rem; border-radius: 0.75rem; border: none; cursor: pointer; transition: background 0.2s;">
                        Submit Suggestion
                    </button>
                </form>
            </div>
        </div>
    `,document.body.appendChild(t)}function Se(){document.getElementById("suggest-topic-modal")?.remove()}async function Me(t){t.preventDefault();const e=document.getElementById("suggest-title").value,n=document.getElementById("suggest-reason").value;try{await ie({title:e,reason:n,userEmail:i.currentUserData?i.currentUserData.email:"anonymous"});const a=document.querySelector("#suggest-topic-modal > div");a.innerHTML=`
            <div style="padding: 3rem 1.5rem; text-align: center;">
                <div style="width: 4rem; height: 4rem; background: #dcfce7; color: #16a34a; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 2rem;">
                    <i class="fas fa-check"></i>
                </div>
                <h3 style="color: #16a34a; font-weight: bold; font-size: 1.5rem; margin-bottom: 0.5rem;">Thank You!</h3>
                <p style="color: #64748b; margin-bottom: 1.5rem;">Your suggestion has been sent to the admins.</p>
                <button onclick="window.closeSuggestTopicModal()" style="background: #f1f5f9; color: #475569; font-weight: 600; padding: 0.75rem 2rem; border-radius: 0.75rem; border: none; cursor: pointer;">
                    Close
                </button>
            </div>
        `}catch(a){console.error("Error submitting suggestion:",a),alert("Failed to submit suggestion.")}}function $e(t,e){const n=document.createElement("div");n.id="dynamic-modal",n.className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-[fadeIn_0.2s_ease-out]",document.documentElement.classList.contains("dark"),n.innerHTML=`
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col overflow-hidden animate-[popIn_0.3s_cubic-bezier(0.175,0.885,0.32,1.275)]">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-800/50">
                <h3 class="text-xl font-bold text-slate-800 dark:text-white flex items-center gap-3">
                    <span class="w-8 h-8 rounded-lg bg-teal-100 dark:bg-teal-900/30 text-teal-600 dark:text-teal-400 flex items-center justify-center text-sm"><i class="fas fa-book-open"></i></span>
                    ${c(t)}
                </h3>
                <button onclick="window.closeDynamicModal()" class="w-8 h-8 rounded-full flex items-center justify-center text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-600 dark:hover:text-slate-200 transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-8 overflow-y-auto custom-scrollbar prose dark:prose-invert max-w-none">
                ${e}
            </div>
            <div class="p-4 border-t border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 flex justify-end">
                <button onclick="window.closeDynamicModal()" class="px-6 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-xl font-semibold hover:bg-slate-300 dark:hover:bg-slate-600 transition">Close</button>
            </div>
        </div>
    `,document.body.appendChild(n)}function Ce(){document.getElementById("dynamic-modal")?.remove()}function De(t){const e=i.topicsData.find(r=>String(r.id)===String(t));if(!e)return;const n=[{name:"teal",hex:"bg-teal-500",light:"bg-teal-100",text:"text-teal-600"},{name:"blue",hex:"bg-blue-500",light:"bg-blue-100",text:"text-blue-600"},{name:"indigo",hex:"bg-indigo-500",light:"bg-indigo-100",text:"text-indigo-600"},{name:"purple",hex:"bg-purple-500",light:"bg-purple-100",text:"text-purple-600"},{name:"rose",hex:"bg-rose-500",light:"bg-rose-100",text:"text-rose-600"},{name:"amber",hex:"bg-amber-500",light:"bg-amber-100",text:"text-amber-600"}];n.find(r=>r.name===e.color)||n[0];const a=e.content||{};let s="";a.bullets&&a.bullets.length>0&&(s=`
            <div class="mb-6">
                <h4 class="font-bold text-lg mb-2 text-slate-800 dark:text-white">Key Signs & Strategies</h4>
                <ul class="list-disc pl-5 space-y-1 text-slate-600 dark:text-slate-300">
                    ${a.bullets.map(r=>`<li>${c(r)}</li>`).join("")}
                </ul>
            </div>
        `);const o=`
        <div class="space-y-6">
            <p class="text-lg text-slate-700 dark:text-slate-300 leading-relaxed">${c(a.intro||e.desc)}</p>
            ${s}
            <div class="bg-teal-50 dark:bg-teal-900/20 p-4 rounded-xl border border-teal-100 dark:border-teal-800">
                <h4 class="font-bold text-teal-800 dark:text-teal-300 mb-1">Action Step</h4>
                <p class="text-teal-700 dark:text-teal-400">${c(a.action||"Contact a peer mentor for support.")}</p>
            </div>
        </div>
    `;$e(e.title,o)}let l=null;function Te(){const t=document.createElement("div");t.id="profile-picture-modal",t.className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-[fadeIn_0.2s_ease-out]";const e=document.documentElement.classList.contains("dark"),n={bg:e?"#1e293b":"#ffffff",text:e?"#f1f5f9":"#1e293b",textMuted:e?"#94a3b8":"#64748b",border:e?"#334155":"#e2e8f0",primary:"#0d9488"};t.innerHTML=`
        <div style="background: ${n.bg}; border-radius: 1.5rem; max-width: 28rem; width: 100%; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);">
            <div style="padding: 1.5rem; border-bottom: 1px solid ${n.border}; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="font-weight: bold; font-size: 1.25rem; color: ${n.text};">Update Profile Photo</h3>
                <button onclick="window.closeProfilePictureModal()" style="color: ${n.textMuted}; background: none; border: none; cursor: pointer; font-size: 1.25rem;"><i class="fas fa-times"></i></button>
            </div>
            
            <!-- Step 1: Upload -->
            <div id="profile-upload-step" style="padding: 2rem; display: flex; flex-direction: column; align-items: center; gap: 1.5rem;">
                <div style="width: 8rem; height: 8rem; border-radius: 50%; background: ${e?"#334155":"#f1f5f9"}; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: ${n.textMuted}; border: 2px dashed ${n.border};">
                    <i class="fas fa-camera"></i>
                </div>
                <div style="text-align: center;">
                    <p style="color: ${n.text}; font-weight: 500; margin-bottom: 0.5rem;">Upload a new photo</p>
                    <p style="color: ${n.textMuted}; font-size: 0.875rem;">JPG or PNG, max 5MB</p>
                </div>
                <label style="background: ${n.primary}; color: white; padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; cursor: pointer; transition: transform 0.1s;">
                    Choose File
                    <input type="file" id="profile-file-input" accept="image/*" style="display: none;" onchange="window.handleProfileImageSelect(event)">
                </label>
                ${i.currentUserData?.photoURL?`
                    <button onclick="window.removeProfilePicture()" style="color: #ef4444; font-size: 0.875rem; font-weight: 500; background: none; border: none; cursor: pointer; padding: 0.5rem;">
                        Remove Current Photo
                    </button>
                `:""}
            </div>

            <!-- Step 2: Crop (Hidden initially) -->
            <div id="profile-crop-step" style="display: none; flex-direction: column; height: 500px;">
                <div style="flex: 1; position: relative; background: #000; overflow: hidden; cursor: grab;" id="crop-container">
                    <img id="profile-crop-image" style="position: absolute; transform-origin: top left; pointer-events: none; user-select: none;">
                    <div style="position: absolute; inset: 0; background: rgba(0,0,0,0.5); pointer-events: none;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; padding-bottom: 80%; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 9999px rgba(0,0,0,0.5);"></div>
                    </div>
                </div>
                <div style="padding: 1.5rem; background: ${n.bg}; border-top: 1px solid ${n.border}; display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                    <button onclick="window.cancelProfileCrop()" style="padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; color: ${n.textMuted}; background: transparent; border: 1px solid ${n.border}; cursor: pointer;">Cancel</button>
                    <button onclick="window.saveProfilePicture()" style="padding: 0.75rem 1.5rem; border-radius: 0.75rem; font-weight: 600; color: white; background: ${n.primary}; border: none; cursor: pointer; flex: 1;">Save Photo</button>
                </div>
                <div style="padding: 0 1.5rem 1.5rem; background: ${n.bg};">
                    <input type="range" id="profile-zoom-slider" min="1" max="3" step="0.01" value="1" style="width: 100%;">
                </div>
            </div>
            
            <!-- Saving Overlay -->
            <div id="profile-saving-overlay" style="display: none; position: absolute; inset: 0; background: rgba(255,255,255,0.9); align-items: center; justify-content: center; flex-direction: column; gap: 1rem; z-index: 50;">
                <div style="width: 3rem; height: 3rem; border: 3px solid ${n.border}; border-top-color: ${n.primary}; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                <p style="color: ${n.text}; font-weight: 600;">Updating Profile...</p>
            </div>
            <style>@keyframes spin { to { transform: rotate(360deg); } }</style>
        </div>
    `,document.body.appendChild(t)}function C(){l=null,document.getElementById("profile-picture-modal")?.remove()}function Pe(t){const e=t.target.files[0];e&&Ue(e)}function Ue(t){if(!t.type.startsWith("image/")){g("Please select an image file","error");return}if(t.size>5*1024*1024){g("Image must be less than 5MB","error");return}const e=new FileReader;e.onload=n=>{document.getElementById("profile-upload-step").style.display="none",document.getElementById("profile-crop-step").style.display="flex";const a=document.getElementById("profile-crop-image"),s=document.getElementById("crop-container");a.onload=()=>{const r=s.getBoundingClientRect().width*.8;let d=a.naturalWidth/a.naturalHeight>1?r/a.naturalHeight:r/a.naturalWidth;l={scale:d,minScale:d,maxScale:d*3,x:0,y:0,isDragging:!1,startX:0,startY:0,imgWidth:a.naturalWidth,imgHeight:a.naturalHeight},D(),a.onmousedown=U,a.ontouchstart=U,document.onmousemove=A,document.ontouchmove=A,document.onmouseup=R,document.ontouchend=R;const f=document.getElementById("profile-zoom-slider");f&&(f.oninput=m=>Ae(m.target.value))},a.src=n.target.result},e.readAsDataURL(t)}function D(){if(!l)return;const t=document.getElementById("profile-crop-image");t&&(t.style.transform=`translate(${l.x}px, ${l.y}px) scale(${l.scale})`)}function U(t){if(!l)return;t.preventDefault(),l.isDragging=!0;const e=t.touches?t.touches[0]:t;l.startX=e.clientX-l.x,l.startY=e.clientY-l.y}function A(t){if(!l||!l.isDragging)return;t.preventDefault();const e=t.touches?t.touches[0]:t;l.x=e.clientX-l.startX,l.y=e.clientY-l.startY,D()}function R(){l&&(l.isDragging=!1)}function Ae(t){l&&(l.scale=l.minScale*parseFloat(t),D())}function Re(){l=null,document.getElementById("profile-crop-step").style.display="none",document.getElementById("profile-upload-step").style.display="flex",document.getElementById("profile-file-input").value=""}async function Ne(){if(!l)return;const t=document.getElementById("profile-saving-overlay");t.style.display="flex";try{const e=document.getElementById("profile-crop-image"),a=document.getElementById("crop-container").getBoundingClientRect(),s=256,o=document.createElement("canvas");o.width=s,o.height=s;const r=o.getContext("2d"),u=a.width*.4,d=a.width/2,f=a.height/2,m=e.getBoundingClientRect(),w=m.left-a.left+m.width/2,h=m.top-a.top+m.height/2,X=d-w,K=f-h,J=e.naturalWidth/2+X/l.scale-u/l.scale,Q=e.naturalHeight/2+K/l.scale-u/l.scale,T=u*2/l.scale;r.beginPath(),r.arc(s/2,s/2,s/2,0,Math.PI*2),r.closePath(),r.clip(),r.drawImage(e,J,Q,T,T,0,0,s,s),o.toBlob(async Z=>{const k=auth.currentUser;if(!k)return;const E=await pe(k.uid,Z);await fe(k.uid,{photoURL:E}),i.mentorsData.some(ee=>ee.email===k.email)&&await j(k.email,{photoURL:E}),i.currentUserData&&(i.currentUserData.photoURL=E),_(E),g("Profile picture updated!","success"),C(),t.style.display="none"},"image/jpeg",.9)}catch(e){console.error("Error saving profile picture:",e),g("Failed to save photo.","error"),t.style.display="none"}}async function je(){if(confirm("Remove profile picture?"))try{const t=auth.currentUser;t&&await be(t.uid),i.currentUserData&&(i.currentUserData.photoURL=null),_(null),g("Profile picture removed","success"),C()}catch(t){console.error(t),g("Failed to remove photo.","error")}}function qe(t){const e=i.mentorsData.find(r=>r.email===t);if(!e)return;const n=i.mentorOverrides[t]||{},a=n.quote||e.quote,s=(n.tags||e.tags).join(", "),o=document.createElement("div");o.id="edit-mentor-modal",o.className="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-[fadeIn_0.2s_ease-out]",document.documentElement.classList.contains("dark"),o.innerHTML=`
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[popIn_0.3s_cubic-bezier(0.175,0.885,0.32,1.275)]">
            <div class="p-6 border-b border-slate-100 dark:border-slate-700 flex justify-between items-center">
                <h3 class="text-xl font-bold text-slate-800 dark:text-white">Edit Mentor Profile</h3>
                <button onclick="document.getElementById('edit-mentor-modal').remove()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Message (Quote)</label>
                    <textarea id="edit-mentor-quote" rows="3" class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-teal-500 transition resize-none">${c(a)}</textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Tags (comma separated)</label>
                    <input type="text" id="edit-mentor-tags" value="${c(s)}" class="w-full px-4 py-2 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-teal-500 transition">
                </div>
            </div>
            <div class="p-6 border-t border-slate-100 dark:border-slate-700 flex justify-end gap-3">
                <button onclick="document.getElementById('edit-mentor-modal').remove()" class="px-4 py-2 rounded-xl text-slate-600 dark:text-slate-400 font-medium hover:bg-slate-100 dark:hover:bg-slate-700 transition">Cancel</button>
                <button onclick="window.saveMentorDetails('${c(t)}')" class="px-6 py-2 rounded-xl bg-teal-500 text-white font-bold hover:bg-teal-600 shadow-lg shadow-teal-500/30 transition transform hover:scale-105">Save Changes</button>
            </div>
        </div>
    `,document.body.appendChild(o)}async function He(t){const e=document.getElementById("edit-mentor-quote").value.trim(),n=document.getElementById("edit-mentor-tags").value.split(",").map(a=>a.trim()).filter(a=>a.length>0);i.mentorOverrides[t]||(i.mentorOverrides[t]={}),i.mentorOverrides[t].quote=e,i.mentorOverrides[t].tags=n,v(),document.getElementById("edit-mentor-modal").remove(),g("Profile updated successfully!","success");try{await j(t,{quote:e,tags:n})}catch(a){console.error("Error saving mentor profile:",a),g("Failed to save changes.","error")}}function Oe(t,e){const n=document.createElement("div");n.id="dynamic-mentor-modal",n.className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",n.onclick=r=>{r.target===n&&W()};const a=document.documentElement.classList.contains("dark"),s=a?"#1e293b":"#ffffff",o=a?"#f1f5f9":"#1e293b";n.innerHTML=`
        <div style="background: ${s}; border-radius: 1rem; max-width: 24rem; width: 100%; padding: 2rem; text-align: center; position: relative;">
            <button onclick="window.closeMentorEmailModal()" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; cursor: pointer; color: ${o};"><i class="fas fa-times"></i></button>
            <div style="width: 4rem; height: 4rem; border-radius: 50%; background: rgba(20, 184, 166, 0.2); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; color: #14b8a6; font-size: 1.5rem;"><i class="fas fa-envelope"></i></div>
            <h2 style="font-size: 1.5rem; font-weight: bold; color: ${o}; margin-bottom: 0.5rem;">Contact ${c(e.split(" ")[0])}</h2>
            <p style="color: #64748b; font-size: 0.875rem; margin-bottom: 1.5rem;">Copy the email address below.</p>
            <p style="font-family: monospace; font-weight: 600; color: ${o}; background: ${a?"#334155":"#f1f5f9"}; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem; user-select: all;">${c(t)}</p>
            <button onclick="window.copyMentorEmailDynamic('${c(t)}')" id="copy-mentor-btn" style="width: 100%; background: #14b8a6; color: white; padding: 0.75rem; border-radius: 0.75rem; font-weight: bold; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <i class="fas fa-copy"></i> Copy Email
            </button>
        </div>
    `,document.body.appendChild(n)}function W(){document.getElementById("dynamic-mentor-modal")?.remove()}function ze(t){navigator.clipboard.writeText(t).then(()=>{const e=document.getElementById("copy-mentor-btn");e&&(e.innerHTML='<i class="fas fa-check"></i> Copied!',setTimeout(()=>e.innerHTML='<i class="fas fa-copy"></i> Copy Email',2e3))})}function Fe(t){const e=i.sessionsData.find(n=>n.id===t);e&&(document.getElementById("new-session-id").value=e.id,document.getElementById("new-session-title").value=e.title,document.getElementById("new-session-host").value=e.host,document.getElementById("new-session-date").value=e.date,document.getElementById("new-session-time").value=e.time,document.getElementById("new-session-duration").value=e.duration,document.getElementById("new-session-platform").value=e.platform,document.getElementById("new-session-tag").value=e.tag,document.getElementById("new-session-link").value=e.link,document.getElementById("new-session-desc").value=e.desc,document.getElementById("session-modal-title").textContent="Edit Session",document.getElementById("session-modal-submit").textContent="Update Session",document.getElementById("admin-add-session").classList.remove("hidden"))}function Ge(){document.getElementById("new-session-id").value="",document.querySelector("#admin-add-session form").reset(),document.getElementById("session-modal-title").textContent="Schedule New Session",document.getElementById("session-modal-submit").textContent="Schedule Session",document.getElementById("admin-add-session").classList.remove("hidden")}async function Ye(t){t.preventDefault();const e=document.getElementById("new-session-id").value,n={title:document.getElementById("new-session-title").value,host:document.getElementById("new-session-host").value,date:document.getElementById("new-session-date").value,time:document.getElementById("new-session-time").value,duration:document.getElementById("new-session-duration").value,platform:document.getElementById("new-session-platform").value,tag:document.getElementById("new-session-tag").value,link:document.getElementById("new-session-link").value,desc:document.getElementById("new-session-desc").value};try{e?(await le(e,n),g("Session Updated!","success")):(await re(n),g("Session Scheduled!","success")),t.target.reset(),document.getElementById("new-session-id").value="",document.getElementById("admin-add-session").classList.add("hidden")}catch(a){console.error("Error saving session: ",a),alert("Failed to save session.")}}let p=!1,y=[];function _e(){const t=document.getElementById("breath-btn"),e=document.getElementById("breathing-widget"),n=document.getElementById("breath-text"),a=document.getElementById("breath-instruction");p?(p=!1,y.forEach(clearTimeout),y=[],t.textContent="Start Exercise",t.classList.replace("bg-red-500","bg-teal-600"),t.classList.replace("hover:bg-red-600","hover:bg-teal-700"),e.className="breathing-widget",n.textContent="Ready?",a.textContent="Tap Start",e.offsetWidth):(p=!0,t.textContent="Stop Exercise",t.classList.replace("bg-teal-600","bg-red-500"),t.classList.replace("hover:bg-teal-700","hover:bg-red-600"),V(e,n,a))}function V(t,e,n){p&&(t.className="breathing-widget inhaling",e.textContent="Inhale...",n.textContent="Breathe in slowly through nose (4s)",y.push(setTimeout(()=>{p&&(t.className="breathing-widget holding",e.textContent="Hold...",n.textContent="Keep lungs full (7s)",y.push(setTimeout(()=>{p&&(t.className="breathing-widget exhaling",e.textContent="Exhale...",n.textContent="Release slowly through mouth (8s)",y.push(setTimeout(()=>{p&&(t.className="breathing-widget resting",e.textContent="Rest...",n.textContent="Relax for a moment (3s)",y.push(setTimeout(()=>{p&&V(t,e,n)},3e3)))},8e3)))},7e3)))},4e3)))}let x="LOGIN";function b(t){x=t;const e=document.getElementById("auth-title"),n=document.getElementById("auth-desc"),a=document.getElementById("auth-submit-btn"),s=document.getElementById("auth-switch-text"),o=document.getElementById("auth-switch-btn"),r=document.getElementById("name-field-container"),u=document.getElementById("password-field-container"),d=document.getElementById("auth-forgot-btn"),f=document.getElementById("auth-guest-btn");r.classList.add("hidden"),u.classList.remove("hidden"),d.classList.remove("hidden"),f.classList.remove("hidden"),t==="SIGNUP"?(e.textContent="Create Account",n.textContent="Join the PeerCircle community.",a.textContent="Sign Up",s.textContent="Already have an account?",o.textContent="Sign In",o.onclick=()=>b("LOGIN"),r.classList.remove("hidden")):t==="LOGIN"?(e.textContent="Welcome Back",n.textContent="Sign in to access resources.",a.textContent="Sign In",s.textContent="New here?",o.textContent="Create Account",o.onclick=()=>b("SIGNUP")):t==="RESET"&&(e.textContent="Reset Password",n.textContent="Enter your email to receive a reset link.",a.textContent="Send Reset Link",u.classList.add("hidden"),d.classList.add("hidden"),f.classList.add("hidden"),s.textContent="Remembered your password?",o.textContent="Back to Login",o.onclick=()=>b("LOGIN"))}function We(){b(x==="LOGIN"?"SIGNUP":"LOGIN")}async function Ve(t){t.preventDefault();const e=document.getElementById("auth-email").value.trim(),n=document.getElementById("auth-password").value,a=document.getElementById("auth-name").value,s=document.getElementById("auth-submit-btn");if(!e.endsWith("@rakmhsu.ac.ae")){alert("Access Restricted: Please use your university email (@rakmhsu.ac.ae).");return}s.disabled=!0,s.textContent="Processing...";try{if(x==="SIGNUP"){const r=(await auth.createUserWithEmailAndPassword(e,n)).user;await ge(r.uid,{name:a,email:e}),await r.sendEmailVerification(),alert("Account created! Please verify your email."),await auth.signOut(),b("LOGIN")}else if(x==="LOGIN"){if(!(await auth.signInWithEmailAndPassword(e,n)).user.emailVerified){alert("Please verify your email address to log in."),await auth.signOut(),s.disabled=!1,s.textContent="Sign In";return}}else x==="RESET"&&(await auth.sendPasswordResetEmail(e),alert("Password reset email sent!"),b("LOGIN"))}catch(o){console.error(o),alert(o.message),s.disabled=!1,x==="SIGNUP"?s.textContent="Sign Up":x==="LOGIN"?s.textContent="Sign In":s.textContent="Send Reset Link"}}function Xe(){const t=document.getElementById("profile-dropdown-menu");t&&t.classList.toggle("hidden")}document.addEventListener("click",t=>{const e=document.getElementById("user-profile-dropdown"),n=document.getElementById("profile-dropdown-menu");e&&n&&!e.contains(t.target)&&n.classList.add("hidden")});async function Ke(t){t.preventDefault();const e=document.getElementById("chat-name").value,n=document.getElementById("chat-email")?document.getElementById("chat-email").value:"no-email@test.com",a=document.getElementById("chat-year").value,s=document.getElementById("chat-topic").value,o=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(document.getElementById("chat-email")&&!o.test(n)){alert("Please enter a valid student email address.");return}try{await ue({name:e,year:a,topic:s,email:n,time:"Anytime"}),document.getElementById("chat-form-container").classList.add("hidden");const r=document.getElementById("chat-success-container");r.classList.remove("hidden"),r.classList.add("flex"),g("Request Sent Successfully","success")}catch(r){console.error("Error sending request:",r),alert("Failed to send request. Please try again.")}}function Je(){document.getElementById("chat-success-container").classList.add("hidden"),document.getElementById("chat-success-container").classList.remove("flex"),document.getElementById("chat-form-container").classList.remove("hidden"),document.querySelector("#chat-form-container form").reset()}async function Qe(t){try{const e=auth.currentUser;if(!e)return;await me(t,e.uid),g("Request Accepted!","success")}catch(e){console.error("Error accepting request:",e),alert("Failed to accept request.")}}document.addEventListener("DOMContentLoaded",()=>{window.scrollTo(0,0),ye(),auth.onAuthStateChanged(async e=>{if(e){if(console.log("User logged in:",e.email),!e.emailVerified){console.log("Email not verified.");return}let n=await P(e.uid),a=0;for(;!n.exists&&a<3;)await new Promise(o=>setTimeout(o,500)),n=await P(e.uid),a++;if(n.exists){const o=n.data();I(o.role||"student"),L({name:o.name||"Student",email:e.email,role:o.role||"student",photoURL:o.photoURL||null}),g(`Welcome back, ${o.name||"Student"}`,"success")}else I("student"),L({name:"Student",email:e.email,role:"student",photoURL:null});M(i.currentUserRole),Y();const s=document.getElementById("loading-screen");s&&(s.classList.add("opacity-0"),setTimeout(()=>s.classList.add("hidden"),500)),document.getElementById("login-modal").classList.add("hidden"),N(O),q(F),ce(G),B(i.mentorsData).then(()=>{v()}),window.scrollTo(0,0)}else{console.log("User logged out");const n=document.getElementById("loading-screen");n&&(n.classList.add("opacity-0"),setTimeout(()=>n.classList.add("hidden"),500)),document.getElementById("login-modal").classList.remove("hidden"),B(i.mentorsData).then(()=>{v()}),M(null)}});const t=document.getElementById("mobile-menu-btn");t&&t.addEventListener("click",H)});window.toggleTheme=ve;window.showSection=t=>{window.location.hash=t};window.toggleMobileMenu=H;window.openModal=he;window.closeModal=xe;window.openTopicModal=De;window.openSuggestTopicModal=Be;window.closeSuggestTopicModal=Se;window.submitSuggestTopic=Me;window.closeDynamicModal=Ce;window.deleteTopic=async(t,e)=>{if(t.stopPropagation(),confirm("Delete this topic?"))try{await oe(e),g("Topic deleted.","success")}catch(n){console.error("Error deleting topic: ",n),alert("Failed to delete topic.")}};window.openProfilePictureModal=Te;window.closeProfilePictureModal=C;window.handleProfileImageSelect=Pe;window.saveProfilePicture=Ne;window.removeProfilePicture=je;window.cancelProfileCrop=Re;window.openEditMentorModal=qe;window.saveMentorDetails=He;window.showMentorEmail=Oe;window.closeMentorEmailModal=W;window.copyMentorEmailDynamic=ze;window.filterMentors=Ee;window.openEditSessionModal=Fe;window.resetSessionModal=Ge;window.handleAddSession=Ye;window.deleteSession=async t=>{if(confirm("Cancel and delete this session?"))try{await de(t),g("Session cancelled.","success")}catch(e){console.error("Error deleting session: ",e),alert("Failed to delete session.")}};window.logout=()=>{auth.signOut().then(()=>{g("Logged Out","success"),window.location.reload()})};window.handleAuth=Ve;window.setAuthMode=b;window.toggleAuthMode=We;window.toggleProfileDropdown=Xe;window.toggleBreathing=_e;window.loginAsGuest=()=>{console.log("Logging in as Guest"),I("guest"),L({name:"Guest User",email:"guest@demo.com",role:"guest",photoURL:null}),document.getElementById("login-modal").classList.add("hidden");const t=document.getElementById("loading-screen");t&&t.classList.add("hidden"),M("guest"),Y(),g("Guest Mode Active","success"),N(O),q(F),B(i.mentorsData).then(()=>{v()})};window.handleBooking=Ke;window.resetChatForm=Je;window.acceptRequest=Qe;window.addEventListener("hashchange",()=>{const t=window.location.hash.substring(1)||"home";we(t)});
